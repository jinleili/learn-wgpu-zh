<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>å…‰ç…§ | å­¦ä¹  wgpu</title><meta name="description" content="ä½¿ç”¨ Rust å­¦ä¹  wgpu">
    <link rel="preload" href="/learn-wgpu-zh/assets/js/runtime~app.1fe6cd89.js" as="script"><link rel="preload" href="/learn-wgpu-zh/assets/css/styles.dbd69ac3.css" as="style"><link rel="preload" href="/learn-wgpu-zh/assets/js/3866.84df6019.js" as="script"><link rel="preload" href="/learn-wgpu-zh/assets/js/app.986ad84b.js" as="script"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-2d69bb60.97588166.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-bfc81dd6.ca69855e.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-4249d10f.bc14afad.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-82a25e06.afd792d8.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-2168b6f4.5dbe9a23.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-1d87647f.2e51dd90.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-5ffceace.0ea5174c.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-b2c95ce4.1841b85e.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-5d0cc617.4c893ad3.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-e038f3ae.891ad23e.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-627538dd.7144e0a7.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-220b0cd1.4e281037.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-64802336.ed141770.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-31840cac.b944bdc2.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-b117cf7e.df64c42f.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/1162.d3408974.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/3475.032efde7.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/5883.33434865.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/7937.6102c3bc.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-5c7d04cb.76f847da.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/2307.5ea4c2d9.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/662.cc3b899d.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/1426.b529462f.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/381.efc9c7f6.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/2277.af6d970b.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/4970.7fbd9d88.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-b3ccb192.bb89c06f.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/5137.7bc11b24.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-0440027a.ea9c48bb.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-2b11540d.5346069c.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-1f0489a3.7877dd28.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-7db95cc0.a6ef9657.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-25d83dbe.bc1e6193.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/6321.6178d5b3.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/5421.d43b8b02.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/4839.56e336fd.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/416.643dde4e.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/2922.e6dabe11.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/4607.39e55359.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/1769.79e89645.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/7854.355fb807.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/7255.d3f412ea.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/5734.e922f752.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/6402.ac52c68d.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/9292.16c9429c.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-0c308a02.7a030052.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-4a3d9733.3b589f04.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-b2a9f5e8.327e2006.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/4204.628e56a7.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-6b60e296.9d3b6356.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-b2a9f626.e6bfd6fc.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-8daa1a0e.64603578.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-8b4c6ddc.774f09f7.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-745c8789.62149ac4.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/9944.09d39f9a.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-afc761bc.a3966cba.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/2076.ea11f7bb.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-3706649a.71b76089.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/75.8e0a872d.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/css/8096.styles.d38597ea.css"><link rel="prefetch" href="/learn-wgpu-zh/assets/css/6681.styles.98ee24e7.css">
    <link rel="stylesheet" href="/learn-wgpu-zh/assets/css/styles.dbd69ac3.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/learn-wgpu-zh/" class=""><img class="logo" src="/learn-wgpu-zh/res/wgpu-logo.png" alt="å­¦ä¹  wgpu"><span class="site-name can-hide">å­¦ä¹  wgpu</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">é€‰æ‹©è¯­è¨€</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">é€‰æ‹©è¯­è¨€</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/learn-wgpu-zh/intermediate/tutorial10-lighting/" class="router-link-active router-link-exact-active router-link-active" aria-label="ç®€ä½“ä¸­æ–‡"><!--[--><!--]--> ç®€ä½“ä¸­æ–‡ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://sotrh.github.io/learn-wgpu/" rel="noopener noreferrer" target="_blank" aria-label="English"><!--[--><!--]--> English <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/jinleili/learn-wgpu-zh" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="æœç´¢" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">é€‰æ‹©è¯­è¨€</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">é€‰æ‹©è¯­è¨€</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/learn-wgpu-zh/intermediate/tutorial10-lighting/" class="router-link-active router-link-exact-active router-link-active" aria-label="ç®€ä½“ä¸­æ–‡"><!--[--><!--]--> ç®€ä½“ä¸­æ–‡ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://sotrh.github.io/learn-wgpu/" rel="noopener noreferrer" target="_blank" aria-label="English"><!--[--><!--]--> English <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/jinleili/learn-wgpu-zh" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/learn-wgpu-zh/" class="sidebar-item sidebar-heading" aria-label="ä»‹ç»"><!--[--><!--]--> ä»‹ç» <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading">åŸºç¡€ <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/learn-wgpu-zh/beginner/tutorial1-window/" class="sidebar-item" aria-label="ä¾èµ–ä¸çª—å£"><!--[--><!--]--> ä¾èµ–ä¸çª—å£ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial2-surface/" class="sidebar-item" aria-label="å±•ç¤ºå¹³é¢ (Surface)"><!--[--><!--]--> å±•ç¤ºå¹³é¢ (Surface) <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial3-pipeline/" class="sidebar-item" aria-label="ç®¡çº¿ (Pipeline)"><!--[--><!--]--> ç®¡çº¿ (Pipeline) <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial4-buffer/" class="sidebar-item" aria-label="ç¼“å†²åŒºä¸ç´¢å¼•"><!--[--><!--]--> ç¼“å†²åŒºä¸ç´¢å¼• <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial5-textures/" class="sidebar-item" aria-label="çº¹ç†å’Œç»‘å®šç»„"><!--[--><!--]--> çº¹ç†å’Œç»‘å®šç»„ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial6-uniforms/" class="sidebar-item" aria-label="Uniform ç¼“å†²åŒºä¸ 3D è™šæ‹Ÿæ‘„åƒæœº"><!--[--><!--]--> Uniform ç¼“å†²åŒºä¸ 3D è™šæ‹Ÿæ‘„åƒæœº <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial7-instancing/" class="sidebar-item" aria-label="å®ä¾‹åŒ–ç»˜åˆ¶"><!--[--><!--]--> å®ä¾‹åŒ–ç»˜åˆ¶ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial8-depth/" class="sidebar-item" aria-label="æ·±åº¦ç¼“å†²åŒº"><!--[--><!--]--> æ·±åº¦ç¼“å†²åŒº <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial9-models/" class="sidebar-item" aria-label="æ¨¡å‹åŠ è½½"><!--[--><!--]--> æ¨¡å‹åŠ è½½ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">è¿›é˜¶ <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/learn-wgpu-zh/intermediate/tutorial10-lighting/" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="å…‰ç…§"><!--[--><!--]--> å…‰ç…§ <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/learn-wgpu-zh/intermediate/tutorial10-lighting/#å…‰çº¿-è·¯å¾„è¿½è¸ª" class="router-link-active router-link-exact-active sidebar-item" aria-label="å…‰çº¿/è·¯å¾„è¿½è¸ª"><!--[--><!--]--> å…‰çº¿/è·¯å¾„è¿½è¸ª <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/learn-wgpu-zh/intermediate/tutorial10-lighting/#blinn-phong-åå°„æ¨¡å‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="Blinn-Phong åå°„æ¨¡å‹"><!--[--><!--]--> Blinn-Phong åå°„æ¨¡å‹ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/learn-wgpu-zh/intermediate/tutorial10-lighting/#æŸ¥çœ‹å…‰æº" class="router-link-active router-link-exact-active sidebar-item" aria-label="æŸ¥çœ‹å…‰æº"><!--[--><!--]--> æŸ¥çœ‹å…‰æº <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/learn-wgpu-zh/intermediate/tutorial10-lighting/#ç¯å¢ƒå…‰åå°„" class="router-link-active router-link-exact-active sidebar-item" aria-label="ç¯å¢ƒå…‰åå°„"><!--[--><!--]--> ç¯å¢ƒå…‰åå°„ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/learn-wgpu-zh/intermediate/tutorial10-lighting/#æ¼«åå°„" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ¼«åå°„"><!--[--><!--]--> æ¼«åå°„ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/learn-wgpu-zh/intermediate/tutorial10-lighting/#æ³•çº¿çŸ©é˜µ" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ³•çº¿çŸ©é˜µ"><!--[--><!--]--> æ³•çº¿çŸ©é˜µ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/learn-wgpu-zh/intermediate/tutorial10-lighting/#é•œé¢åå°„" class="router-link-active router-link-exact-active sidebar-item" aria-label="é•œé¢åå°„"><!--[--><!--]--> é•œé¢åå°„ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/learn-wgpu-zh/intermediate/tutorial10-lighting/#åŠç¨‹å‘é‡" class="router-link-active router-link-exact-active sidebar-item" aria-label="åŠç¨‹å‘é‡"><!--[--><!--]--> åŠç¨‹å‘é‡ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/learn-wgpu-zh/intermediate/tutorial11-normals/" class="sidebar-item" aria-label="æ³•çº¿æ˜ å°„"><!--[--><!--]--> æ³•çº¿æ˜ å°„ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/intermediate/tutorial12-camera/" class="sidebar-item" aria-label="æ›´å¥½çš„æ‘„åƒæœº"><!--[--><!--]--> æ›´å¥½çš„æ‘„åƒæœº <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">é›†æˆä¸è°ƒè¯• <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/learn-wgpu-zh/integration-and-debugging/" class="sidebar-item" aria-label="æ¥”å­"><!--[--><!--]--> æ¥”å­ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/integration-and-debugging/ios/" class="sidebar-item" aria-label="ğŸ†• ä¸ iOS App é›†æˆ"><!--[--><!--]--> ğŸ†• ä¸ iOS App é›†æˆ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/integration-and-debugging/android/" class="sidebar-item" aria-label="ğŸ†• ä¸ Android App é›†æˆ"><!--[--><!--]--> ğŸ†• ä¸ Android App é›†æˆ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/integration-and-debugging/xcode/" class="sidebar-item" aria-label="ğŸ†• ä½¿ç”¨ Xcode è°ƒè¯• wgpu ç¨‹åº"><!--[--><!--]--> ğŸ†• ä½¿ç”¨ Xcode è°ƒè¯• wgpu ç¨‹åº <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/integration-and-debugging/snapdragon-profiler/" class="sidebar-item" aria-label="ğŸ†• ä½¿ç”¨ Snapdragon Profiler è°ƒè¯•"><!--[--><!--]--> ğŸ†• ä½¿ç”¨ Snapdragon Profiler è°ƒè¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">æ¡ˆä¾‹å±•ç¤º <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/learn-wgpu-zh/showcase/windowless/" class="sidebar-item" aria-label="ç¦»å±æ¸²æŸ“"><!--[--><!--]--> ç¦»å±æ¸²æŸ“ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/showcase/gifs/" class="sidebar-item" aria-label="ç”Ÿæˆ GIF åŠ¨å›¾"><!--[--><!--]--> ç”Ÿæˆ GIF åŠ¨å›¾ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/showcase/pong/" class="sidebar-item" aria-label="Pong"><!--[--><!--]--> Pong <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/showcase/compute/" class="sidebar-item" aria-label="Compute Example: Tangents and Bitangents"><!--[--><!--]--> Compute Example: Tangents and Bitangents <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/showcase/alignment/" class="sidebar-item" aria-label="Memory Layout in WGSL"><!--[--><!--]--> Memory Layout in WGSL <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/showcase/imgui-demo/" class="sidebar-item" aria-label="Basic Imgui Demo"><!--[--><!--]--> Basic Imgui Demo <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/learn-wgpu-zh/GLOSSARY_OF_TERMS.html" class="sidebar-item sidebar-heading" aria-label="æœ¯è¯­ä¸­è‹±å¯¹ç…§è¡¨"><!--[--><!--]--> æœ¯è¯­ä¸­è‹±å¯¹ç…§è¡¨ <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="å…‰ç…§" tabindex="-1"><a class="header-anchor" href="#å…‰ç…§" aria-hidden="true">#</a> å…‰ç…§</h1><p>è™½ç„¶æˆ‘ä»¬çš„åœºæ™¯æ˜¯ 3D çš„ï¼Œä½†å®ƒä»¬çœ‹èµ·æ¥åƒæ˜¯å¹³çš„ï¼Œ<strong>å¯¹è±¡</strong>è¡¨é¢ç¼ºä¹ç°å®å…‰ç…§ç¯å¢ƒä¸­çš„æ˜æš—å˜åŒ–ï¼Œæ‰€ä»¥æ— æ³•ä½“ç°æ¨¡å‹çš„ä¸‰ç»´ç‰¹æ€§ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„æ¨¡å‹æ²¡æœ‰è€ƒè™‘å…‰çº¿å’Œå¯¹è±¡è¡¨é¢ä¹‹é—´çš„ç›¸äº’ä½œç”¨ï¼Œæ— è®ºå¦‚ä½•æ‘†æ”¾éƒ½ä¼šä¿æŒç€ç›¸åŒçš„ç€è‰²ã€‚</p><p>å¦‚æœæƒ³ä¿®æ­£è¿™ä¸€ç‚¹ï¼Œå°±éœ€è¦åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­æ·»åŠ <strong>å…‰ç…§</strong>ï¼ˆLightingï¼‰ã€‚</p><p>åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œå…‰æºå‘å‡ºçš„å…‰å­ä¼šå››å¤„åå°„ï¼Œæœ€åè¿›å…¥æˆ‘ä»¬çš„çœ¼ç›ã€‚ å½“è§‚å¯Ÿå¯¹è±¡ä¸Šçš„ä¸€ç‚¹æ—¶ï¼Œæˆ‘ä»¬æ‰€çœ‹åˆ°çš„é¢œè‰²å–å†³äºå¤šä¸ªå…‰æºå’Œå¤šä¸ªåå°„è¡¨é¢ä¹‹é—´çš„å¤šæ¬¡ç›¸äº’ä½œç”¨ã€‚</p><p>åœ¨è®¡ç®—æœºå›¾å½¢å­¦é¢†åŸŸï¼Œä¸ºå•ä¸ªå…‰å­å»ºæ¨¡çš„è®¡ç®—æˆæœ¬æé«˜ã€‚ä¸€ä¸ª 100 ç“¦çš„ç¯æ³¡æ¯ç§’é’Ÿå‘å‡ºå¤§çº¦ 3.27Ã—10^20 ä¸ªå…‰å­ï¼Œå†è¯•æƒ³ä¸€ä¸‹å¤ªé˜³æ¯ç§’å‘å‡ºçš„å…‰å­çš„æ•°é‡çº§ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¦ç”¨æ•°å­¦æ¥ <strong>â€œä½œå¼Šâ€</strong>ï¼ˆä¹Ÿå°±æ˜¯<strong>æ¨¡æ‹Ÿ</strong>ã€‚ä¸¥æ ¼æ¥è¯´ï¼Œè¿™ä¸æ˜¯ä½œå¼Šï¼Œè®¡ç®—æœºå›¾å½¢å­¦é‡Œæœ‰è¿™ä¹ˆä¸€å¥åè¨€ï¼š&quot;If it looks right, it is right.&quot;, æ„æ€å°±æ˜¯ï¼Œå¦‚æœå®ƒçœ‹èµ·æ¥æ˜¯å¯¹çš„ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å¯¹çš„ï¼‰ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹è®¡ç®—æœºå›¾å½¢å­¦é‡Œå¸¸ç”¨çš„å‡ ä¸ª<strong>å…‰ç…§</strong>æ¨¡å‹ã€‚</p><h2 id="å…‰çº¿-è·¯å¾„è¿½è¸ª" tabindex="-1"><a class="header-anchor" href="#å…‰çº¿-è·¯å¾„è¿½è¸ª" aria-hidden="true">#</a> å…‰çº¿/è·¯å¾„è¿½è¸ª</h2><p><strong>å…‰çº¿/è·¯å¾„è¿½è¸ª</strong>ï¼ˆRay/Path tracingï¼‰ä»¥è™›æ‹Ÿæ‘„åƒæœºæ¨¡å‹ä¸ºåŸºç¡€ï¼Œä½†æ˜¯å¯¹äºæ¯æ¡ä¸æŸä¸ªä¸‰è§’å½¢ç›¸äº¤çš„æŠ•å½±çº¿ï¼Œåœ¨è®¡ç®—å…‰æºå¯¹äº¤ç‚¹å¤„æ˜æš—å€¼çš„ç›´æ¥è´¡çŒ®ä¹‹å‰ï¼Œè¿˜è¦ç¡®å®šæ˜¯å¦æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªå…‰æºèƒ½å¤Ÿç…§å°„åˆ°è¿™ä¸ªäº¤ç‚¹ã€‚</p><p>å®ƒæ˜¯æœ€æ¥è¿‘å…‰çš„çœŸå®å·¥ä½œæ–¹å¼çš„æ¨¡å‹ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—å¿…é¡»æåˆ°å®ƒã€‚ä½†è¿™æ˜¯ä¸€ä¸ª<em>é«˜çº§</em>è¯é¢˜ï¼Œæˆ‘ä»¬ä¸ä¼šåœ¨è¿™é‡Œæ·±å…¥è®¨è®ºã€‚</p><h2 id="blinn-phong-åå°„æ¨¡å‹" tabindex="-1"><a class="header-anchor" href="#blinn-phong-åå°„æ¨¡å‹" aria-hidden="true">#</a> Blinn-Phong åå°„æ¨¡å‹</h2><p>å¯¹äºå¤§å¤šæ•°<strong>å®æ—¶</strong>ï¼ˆreal-timeï¼‰åº”ç”¨æ¥è¯´ï¼Œ<strong>å…‰çº¿/è·¯å¾„è¿½è¸ª</strong>çš„è®¡ç®—æˆæœ¬ååœ¨å¤ªé«˜äº†ï¼ˆå°½ç®¡è¿™ç§æƒ…å†µå·²ç»å¼€å§‹æ”¹å˜ï¼‰ï¼Œæ‰€ä»¥é€šå¸¸ä½¿ç”¨ä¸€ç§æ›´æœ‰æ•ˆçš„ï¼Œç²¾åº¦è¾ƒä½çš„ <a href="https://en.wikipedia.org/wiki/Phong_shading" target="_blank" rel="noopener noreferrer">Phong åå°„æ¨¡å‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æ¥è§£å†³å…‰ç…§é—®é¢˜ã€‚å®ƒè€ƒè™‘äº†å…‰çº¿ä¸æè´¨çš„ 3 ç§ç›¸äº’ä½œç”¨ï¼šç¯å¢ƒå…‰åå°„ã€æ¼«åå°„å’Œé•œé¢åå°„ã€‚æˆ‘ä»¬å°†å­¦ä¹  <a href="https://en.wikipedia.org/wiki/Blinn%E2%80%93Phong_reflection_model" target="_blank" rel="noopener noreferrer">Blinn-Phong åå°„æ¨¡å‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼Œå®ƒèƒ½åŠ é€Ÿé•œé¢åå°„çš„è®¡ç®—ã€‚</p><p>åœ¨å¼€å§‹å­¦ä¹ ä¹‹å‰ï¼Œéœ€è¦åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­æ·»åŠ ä¸€ä¸ªå…‰æºï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// lib.rs</span>
<span class="token attribute attr-name">#[repr(C)]</span>
<span class="token attribute attr-name">#[derive(Debug, Copy, Clone, bytemuck::Pod, bytemuck::Zeroable)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">LightUniform</span> <span class="token punctuation">{</span>
    position<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// ç”±äº Uniform éœ€è¦å­—æ®µæŒ‰ 16 å­—èŠ‚å¯¹é½ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿™é‡Œä½¿ç”¨ä¸€ä¸ªå¡«å……å­—æ®µ</span>
    _padding<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    color<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    _padding2<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>LightUniform</code> ä»£è¡¨ç©ºé—´ä¸­çš„ä¸€ä¸ªå½©è‰²ç‚¹å…‰æºã€‚è™½ç„¶é€šå¸¸æ˜¯ä½¿ç”¨çº¯ç™½è‰²çš„å…‰ï¼Œä½†ä½¿ç”¨å…¶å®ƒé¢œè‰²çš„å…‰ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><div class="note"><p>ä½¿ WGSL <strong>ç»“æ„ä½“</strong>å†…å­˜å­—èŠ‚å¯¹é½çš„ç»éªŒæ³•åˆ™æ˜¯ï¼šå­—æ®µä¿æŒæŒ‰ 2 çš„ N æ¬¡å¹‚æ¥å¯¹é½ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ª <code>vec3</code> å¦‚æœæ˜¯ 3 ä¸ªå•ç²¾åº¦æµ®ç‚¹æ•°ï¼Œå®ƒçš„å¤§å°ä¸º 12 å­—èŠ‚ï¼Œå¯¹é½åå°†è¢«æå‡åˆ° 2 çš„ä¸‹ä¸€ä¸ªæ¬¡å¹‚ï¼Œå³ 16 å­—èŠ‚. è¿™æ„å‘³ç€å¿…é¡»æ›´åŠ å°å¿ƒåœ°å¸ƒå±€ä½ çš„ç»“æ„ä½“ã€‚</p><p>ä¸€äº›å¼€å‘è€…ä¼šé€‰æ‹©ä½¿ç”¨ <code>vec4</code> è€Œä¸æ˜¯ <code>vec3</code> æ¥é¿å…å¯¹é½é—®é¢˜ã€‚ ä½ å¯ä»¥åœ¨ <a href="https://www.w3.org/TR/WGSL/#alignment-and-size" target="_blank" rel="noopener noreferrer">wgsl spec<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ä¸­äº†è§£æ›´å¤šå…³äºå¯¹é½è§„åˆ™çš„ä¿¡æ¯ã€‚</p></div><p>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ª Uniform ç¼“å†²åŒºæ¥å­˜å‚¨æˆ‘ä»¬çš„å…‰æºï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> light_uniform <span class="token operator">=</span> <span class="token class-name">LightUniform</span> <span class="token punctuation">{</span>
    position<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    _padding<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    color<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    _padding2<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

 <span class="token comment">// æˆ‘ä»¬å¸Œæœ›èƒ½æ›´æ–°å…‰æºä½ç½®ï¼Œæ‰€ä»¥ç”¨äº† COPY_DST è¿™ä¸ªä½¿ç”¨èŒƒå›´æ ‡å¿—</span>
<span class="token keyword">let</span> light_buffer <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_buffer_init</span><span class="token punctuation">(</span>
    <span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span>util<span class="token punctuation">::</span></span><span class="token class-name">BufferInitDescriptor</span> <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Light VB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        contents<span class="token punctuation">:</span> <span class="token namespace">bytemuck<span class="token punctuation">::</span></span><span class="token function">cast_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span>light_uniform<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        usage<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferUsages</span><span class="token punctuation">::</span><span class="token constant">UNIFORM</span> <span class="token operator">|</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferUsages</span><span class="token punctuation">::</span><span class="token constant">COPY_DST</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ«å¿˜è®°æŠŠ <code>light_uniform</code> å’Œ <code>light_buffer</code> æ·»åŠ åˆ° <code>State</code>ã€‚ä¹‹åï¼Œæˆ‘ä»¬ä¸ºå…‰æºåˆ›å»ºä¸€ä¸ªç»‘å®šç»„çš„<strong>å¸ƒå±€</strong>åŠ<strong>ç»‘å®šç»„</strong>ï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> light_bind_group_layout <span class="token operator">=</span>
    device<span class="token punctuation">.</span><span class="token function">create_bind_group_layout</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupLayoutDescriptor</span> <span class="token punctuation">{</span>
        entries<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupLayoutEntry</span> <span class="token punctuation">{</span>
            binding<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            visibility<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderStages</span><span class="token punctuation">::</span><span class="token constant">VERTEX</span> <span class="token operator">|</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderStages</span><span class="token punctuation">::</span><span class="token constant">FRAGMENT</span><span class="token punctuation">,</span>
            ty<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindingType</span><span class="token punctuation">::</span><span class="token class-name">Buffer</span> <span class="token punctuation">{</span>
                ty<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferBindingType</span><span class="token punctuation">::</span><span class="token class-name">Uniform</span><span class="token punctuation">,</span>
                has_dynamic_offset<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                min_binding_size<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            count<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        label<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> light_bind_group <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_bind_group</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupDescriptor</span> <span class="token punctuation">{</span>
    layout<span class="token punctuation">:</span> <span class="token operator">&amp;</span>light_bind_group_layout<span class="token punctuation">,</span>
    entries<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupEntry</span> <span class="token punctuation">{</span>
        binding<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        resource<span class="token punctuation">:</span> light_buffer<span class="token punctuation">.</span><span class="token function">as_entire_binding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    label<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŠŠå®ƒä»¬æ·»åŠ åˆ° <code>State</code> ä¸­ï¼ŒåŒæ—¶æ›´æ–° <code>render_pipeline_layout</code>ï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> render_pipeline_layout <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_pipeline_layout</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PipelineLayoutDescriptor</span> <span class="token punctuation">{</span>
    bind_group_layouts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
        <span class="token operator">&amp;</span>texture_bind_group_layout<span class="token punctuation">,</span> 
        <span class="token operator">&amp;</span>camera_bind_group_layout<span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>light_bind_group_layout<span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ <code>update()</code> å‡½æ•°ä¸­æ›´æ–°å…‰æºçš„ä½ç½®ï¼Œè¿™æ ·ä¾¿èƒ½çœ‹åˆ°<strong>å¯¹è±¡</strong>åœ¨ä¸åŒè§’åº¦ä¸‹çš„å…‰ç…§æ•ˆæœï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// æ›´æ–°å…‰æº</span>
<span class="token keyword">let</span> old_position<span class="token punctuation">:</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Vector3</span><span class="token operator">&lt;</span>_<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>light_uniform<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">self</span><span class="token punctuation">.</span>light_uniform<span class="token punctuation">.</span>position <span class="token operator">=</span>
    <span class="token punctuation">(</span><span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Quaternion</span><span class="token punctuation">::</span><span class="token function">from_axis_angle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Deg</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token operator">*</span> old_position<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">self</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">write_buffer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>light_buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token namespace">bytemuck<span class="token punctuation">::</span></span><span class="token function">cast_slice</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>light_uniform<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç ä½¿å…‰æºå›´ç»•åŸç‚¹ä»¥æ¯<strong>å¸§</strong> 1 åº¦çš„é€Ÿåº¦æ—‹è½¬ã€‚</p><h2 id="æŸ¥çœ‹å…‰æº" tabindex="-1"><a class="header-anchor" href="#æŸ¥çœ‹å…‰æº" aria-hidden="true">#</a> æŸ¥çœ‹å…‰æº</h2><p>å‡ºäºè°ƒè¯•çš„ç›®çš„ï¼Œå¦‚æœèƒ½å¤ŸæŸ¥çœ‹<strong>å…‰æº</strong>æœ¬èº«çš„ä½ç½®ï¼Œä»¥ç¡®ä¿åœºæ™¯çš„<strong>å…‰ç…§</strong>æ•ˆæœæ˜¯æ­£ç¡®çš„ï¼Œé‚£å°±å¤ªå¥½äº†ã€‚</p><p>å°½ç®¡å¯ä»¥ç›´æ¥è°ƒæ•´ç°æœ‰çš„<strong>æ¸²æŸ“ç®¡çº¿</strong>æ¥ç»˜åˆ¶å…‰æºï¼Œä½†è¿™å¯èƒ½ä¸åˆ©äºä»£ç çš„ç»´æŠ¤ã€‚æ‰€ä»¥æˆ‘ä»¬æŠŠåˆ›å»ºæ¸²æŸ“ç®¡çº¿çš„ä»£ç æå–åˆ°ä¸€ä¸ªå«åš <code>create_render_pipeline()</code> çš„æ–°å‡½æ•°ä¸­ï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">create_render_pipeline</span><span class="token punctuation">(</span>
    device<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Device</span><span class="token punctuation">,</span>
    layout<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PipelineLayout</span><span class="token punctuation">,</span>
    color_format<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureFormat</span><span class="token punctuation">,</span>
    depth_format<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureFormat</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    vertex_layouts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexBufferLayout</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    shader<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderModuleDescriptor</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RenderPipeline</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> shader <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_shader_module</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>

    device<span class="token punctuation">.</span><span class="token function">create_render_pipeline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RenderPipelineDescriptor</span> <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Render Pipeline&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        layout<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>layout<span class="token punctuation">)</span><span class="token punctuation">,</span>
        vertex<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexState</span> <span class="token punctuation">{</span>
            module<span class="token punctuation">:</span> <span class="token operator">&amp;</span>shader<span class="token punctuation">,</span>
            entry_point<span class="token punctuation">:</span> <span class="token string">&quot;vs_main&quot;</span><span class="token punctuation">,</span>
            buffers<span class="token punctuation">:</span> vertex_layouts<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        fragment<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">FragmentState</span> <span class="token punctuation">{</span>
            module<span class="token punctuation">:</span> <span class="token operator">&amp;</span>shader<span class="token punctuation">,</span>
            entry_point<span class="token punctuation">:</span> <span class="token string">&quot;fs_main&quot;</span><span class="token punctuation">,</span>
            targets<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ColorTargetState</span> <span class="token punctuation">{</span>
                format<span class="token punctuation">:</span> color_format<span class="token punctuation">,</span>
                blend<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BlendState</span> <span class="token punctuation">{</span>
                    alpha<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BlendComponent</span><span class="token punctuation">::</span><span class="token constant">REPLACE</span><span class="token punctuation">,</span>
                    color<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BlendComponent</span><span class="token punctuation">::</span><span class="token constant">REPLACE</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                write_mask<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ColorWrites</span><span class="token punctuation">::</span><span class="token constant">ALL</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        primitive<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PrimitiveState</span> <span class="token punctuation">{</span>
            topology<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PrimitiveTopology</span><span class="token punctuation">::</span><span class="token class-name">TriangleList</span><span class="token punctuation">,</span>
            strip_index_format<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
            front_face<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">FrontFace</span><span class="token punctuation">::</span><span class="token class-name">Ccw</span><span class="token punctuation">,</span>
            cull_mode<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Face</span><span class="token punctuation">::</span><span class="token class-name">Back</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// æ­¤å¤„è®¾ç½®ä¸º Fill ä»¥å¤–çš„ä»»ä½•å€¼éƒ½éœ€è¦å¼€å¯ Feature::NON_FILL_POLYGON_MODE</span>
            polygon_mode<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PolygonMode</span><span class="token punctuation">::</span><span class="token class-name">Fill</span><span class="token punctuation">,</span>
            unclipped_depth<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            conservative<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        depth_stencil<span class="token punctuation">:</span> depth_format<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>format<span class="token closure-punctuation punctuation">|</span></span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">DepthStencilState</span> <span class="token punctuation">{</span>
            format<span class="token punctuation">,</span>
            depth_write_enabled<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            depth_compare<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">CompareFunction</span><span class="token punctuation">::</span><span class="token class-name">Less</span><span class="token punctuation">,</span>
            stencil<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">StencilState</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            bias<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">DepthBiasState</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        multisample<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">MultisampleState</span> <span class="token punctuation">{</span>
            count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            mask<span class="token punctuation">:</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>
            alpha_to_coverage_enabled<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹ <code>State::new()</code> ä¸­çš„ä»£ç æ¥è°ƒç”¨ <code>create_render_pipeline</code> å‡½æ•°ï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> render_pipeline <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> shader <span class="token operator">=</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderModuleDescriptor</span> <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Normal Shader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        source<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderSource</span><span class="token punctuation">::</span><span class="token class-name">Wgsl</span><span class="token punctuation">(</span><span class="token macro property">include_str!</span><span class="token punctuation">(</span><span class="token string">&quot;shader.wgsl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">create_render_pipeline</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span>device<span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>render_pipeline_layout<span class="token punctuation">,</span>
        config<span class="token punctuation">.</span>format<span class="token punctuation">,</span>
        <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">texture<span class="token punctuation">::</span></span><span class="token class-name">Texture</span><span class="token punctuation">::</span><span class="token constant">DEPTH_FORMAT</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token namespace">model<span class="token punctuation">::</span></span><span class="token class-name">ModelVertex</span><span class="token punctuation">::</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">InstanceRaw</span><span class="token punctuation">::</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        shader<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹ <code>model::DrawModel</code> ä»¥ä½¿ç”¨ <code>light_bind_group</code>ï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// model.rs</span>
<span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">DrawModel</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;a</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">draw_mesh</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
        mesh<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token class-name">Mesh</span><span class="token punctuation">,</span>
        material<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token class-name">Material</span><span class="token punctuation">,</span>
        camera_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
        light_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">draw_mesh_instanced</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
        mesh<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token class-name">Mesh</span><span class="token punctuation">,</span>
        material<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token class-name">Material</span><span class="token punctuation">,</span>
        instances<span class="token punctuation">:</span> <span class="token class-name">Range</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        camera_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
        light_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">draw_model</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
        model<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token class-name">Model</span><span class="token punctuation">,</span>
        camera_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
        light_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">draw_model_instanced</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
        model<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token class-name">Model</span><span class="token punctuation">,</span>
        instances<span class="token punctuation">:</span> <span class="token class-name">Range</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        camera_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
        light_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;a</span><span class="token punctuation">,</span> <span class="token lifetime-annotation symbol">&#39;b</span><span class="token operator">&gt;</span> <span class="token class-name">DrawModel</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;b</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RenderPass</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;a</span><span class="token operator">&gt;</span>
<span class="token keyword">where</span>
    <span class="token lifetime-annotation symbol">&#39;b</span><span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">&#39;a</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">draw_mesh</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
        mesh<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token class-name">Mesh</span><span class="token punctuation">,</span>
        material<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token class-name">Material</span><span class="token punctuation">,</span>
        camera_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
        light_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">draw_mesh_instanced</span><span class="token punctuation">(</span>mesh<span class="token punctuation">,</span> material<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">,</span> camera_bind_group<span class="token punctuation">,</span> light_bind_group<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">draw_mesh_instanced</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
        mesh<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token class-name">Mesh</span><span class="token punctuation">,</span>
        material<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token class-name">Material</span><span class="token punctuation">,</span>
        instances<span class="token punctuation">:</span> <span class="token class-name">Range</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        camera_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
        light_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">set_vertex_buffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> mesh<span class="token punctuation">.</span>vertex_buffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">set_index_buffer</span><span class="token punctuation">(</span>mesh<span class="token punctuation">.</span>index_buffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">IndexFormat</span><span class="token punctuation">::</span><span class="token class-name">Uint32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">set_bind_group</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>material<span class="token punctuation">.</span>bind_group<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">set_bind_group</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> camera_bind_group<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">set_bind_group</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> light_bind_group<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">draw_indexed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span>mesh<span class="token punctuation">.</span>num_elements<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> instances<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">draw_model</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
        model<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token class-name">Model</span><span class="token punctuation">,</span>
        camera_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
        light_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">draw_model_instanced</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">,</span> camera_bind_group<span class="token punctuation">,</span> light_bind_group<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">draw_model_instanced</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
        model<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token class-name">Model</span><span class="token punctuation">,</span>
        instances<span class="token punctuation">:</span> <span class="token class-name">Range</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        camera_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
        light_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> mesh <span class="token keyword">in</span> <span class="token operator">&amp;</span>model<span class="token punctuation">.</span>meshes <span class="token punctuation">{</span>
            <span class="token keyword">let</span> material <span class="token operator">=</span> <span class="token operator">&amp;</span>model<span class="token punctuation">.</span>materials<span class="token punctuation">[</span>mesh<span class="token punctuation">.</span>material<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">draw_mesh_instanced</span><span class="token punctuation">(</span>mesh<span class="token punctuation">,</span> material<span class="token punctuation">,</span> instances<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> camera_bind_group<span class="token punctuation">,</span> light_bind_group<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®Œæˆè¿™äº›åï¼Œå°±å¯ä»¥ä¸ºæˆ‘ä»¬çš„å…‰æºåˆ›å»ºå¦ä¸€æ¡æ¸²æŸ“ç®¡çº¿äº†ï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// lib.rs</span>
<span class="token keyword">let</span> light_render_pipeline <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> layout <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_pipeline_layout</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PipelineLayoutDescriptor</span> <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Light Pipeline Layout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        bind_group_layouts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>camera_bind_group_layout<span class="token punctuation">,</span> <span class="token operator">&amp;</span>light_bind_group_layout<span class="token punctuation">]</span><span class="token punctuation">,</span>
        push_constant_ranges<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> shader <span class="token operator">=</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderModuleDescriptor</span> <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Light Shader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        source<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderSource</span><span class="token punctuation">::</span><span class="token class-name">Wgsl</span><span class="token punctuation">(</span><span class="token macro property">include_str!</span><span class="token punctuation">(</span><span class="token string">&quot;light.wgsl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">create_render_pipeline</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span>device<span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>layout<span class="token punctuation">,</span>
        config<span class="token punctuation">.</span>format<span class="token punctuation">,</span>
        <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">texture<span class="token punctuation">::</span></span><span class="token class-name">Texture</span><span class="token punctuation">::</span><span class="token constant">DEPTH_FORMAT</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token namespace">model<span class="token punctuation">::</span></span><span class="token class-name">ModelVertex</span><span class="token punctuation">::</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        shader<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘é€‰æ‹©ä¸º <code>light_render_pipeline</code> åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„<strong>å¸ƒå±€</strong>ï¼Œå› ä¸ºå®ƒä¸éœ€è¦å¸¸è§„<strong>æ¸²æŸ“ç®¡çº¿</strong>æ‰€éœ€è¦çš„èµ„æºï¼ˆä¸»è¦æ˜¯çº¹ç†ï¼‰ã€‚</p><p>ä¹‹åï¼Œæˆ‘ä»¬æ¥ç¼–å†™å®é™…çš„ç€è‰²å™¨ä»£ç ï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token comment">// light.wgsl</span>
<span class="token comment">// é¡¶ç‚¹ç€è‰²å™¨</span>

<span class="token keyword">struct</span> <span class="token class-name">Camera</span> <span class="token punctuation">{</span>
    view_proj<span class="token punctuation">:</span> <span class="token builtin">mat4x4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token punctuation">@</span><span class="token attributes attr-name">group</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> <span class="token punctuation">@</span><span class="token attributes attr-name">binding</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span>
<span class="token keyword">var</span><span class="token punctuation">&lt;</span><span class="token keyword">uniform</span><span class="token punctuation">&gt;</span> camera<span class="token punctuation">:</span> <span class="token class-name">Camera</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">Light</span> <span class="token punctuation">{</span>
    position<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    color<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token punctuation">@</span><span class="token attributes attr-name">group</span><span class="token punctuation">(</span><span class="token int-literal number">1</span><span class="token punctuation">)</span> <span class="token punctuation">@</span><span class="token attributes attr-name">binding</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span>
<span class="token keyword">var</span><span class="token punctuation">&lt;</span><span class="token keyword">uniform</span><span class="token punctuation">&gt;</span> light<span class="token punctuation">:</span> <span class="token class-name">Light</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">VertexInput</span> <span class="token punctuation">{</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> position<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">VertexOutput</span> <span class="token punctuation">{</span>
    <span class="token punctuation">@</span><span class="token builtin-attribute"><span class="token attribute attr-name">builtin</span><span class="token punctuation">(</span><span class="token built-in-values attr-value">position</span><span class="token punctuation">)</span></span> clip_position<span class="token punctuation">:</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> color<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">@</span><span class="token attributes attr-name">vertex</span>
<span class="token keyword">fn</span> <span class="token functions function">vs_main</span><span class="token punctuation">(</span>
    model<span class="token punctuation">:</span> <span class="token class-name">VertexInput</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">VertexOutput</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> scale <span class="token operator">=</span> <span class="token decimal-float-literal number">0.25</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> out<span class="token punctuation">:</span> <span class="token class-name">VertexOutput</span><span class="token punctuation">;</span>
    out<span class="token punctuation">.</span>clip_position <span class="token operator">=</span> camera<span class="token punctuation">.</span>view_proj <span class="token operator">*</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>position <span class="token operator">*</span> scale <span class="token operator">+</span> light<span class="token punctuation">.</span>position<span class="token punctuation">,</span> <span class="token decimal-float-literal number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    out<span class="token punctuation">.</span>color <span class="token operator">=</span> light<span class="token punctuation">.</span>color<span class="token punctuation">;</span>
    <span class="token keyword">return</span> out<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç‰‡å…ƒç€è‰²å™¨</span>

<span class="token punctuation">@</span><span class="token attributes attr-name">fragment</span>
<span class="token keyword">fn</span> <span class="token functions function">fs_main</span><span class="token punctuation">(</span>in<span class="token punctuation">:</span> <span class="token class-name">VertexOutput</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span>in<span class="token punctuation">.</span>color<span class="token punctuation">,</span> <span class="token decimal-float-literal number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨å°±èƒ½åœ¨ <code>render()</code> å‡½æ•°ä¸­æ‰‹åŠ¨å®ç°å…‰æºçš„ç»˜åˆ¶ä»£ç äº†ï¼Œä½†æ˜¯ä¸ºäº†ä¿æŒä¹‹å‰å¼€å‘çš„ç»˜åˆ¶æ¨¡å¼ï¼Œè®©æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªåä¸º <code>DrawLight</code> çš„æ–° traitï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// model.rs</span>
<span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">DrawLight</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;a</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">draw_light_mesh</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
        mesh<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token class-name">Mesh</span><span class="token punctuation">,</span>
        camera_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
        light_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">draw_light_mesh_instanced</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
        mesh<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token class-name">Mesh</span><span class="token punctuation">,</span>
        instances<span class="token punctuation">:</span> <span class="token class-name">Range</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        camera_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
        light_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">draw_light_model</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
        model<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token class-name">Model</span><span class="token punctuation">,</span>
        camera_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
        light_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">draw_light_model_instanced</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
        model<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token class-name">Model</span><span class="token punctuation">,</span>
        instances<span class="token punctuation">:</span> <span class="token class-name">Range</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        camera_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
        light_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;a</span><span class="token punctuation">,</span> <span class="token lifetime-annotation symbol">&#39;b</span><span class="token operator">&gt;</span> <span class="token class-name">DrawLight</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;b</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RenderPass</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;a</span><span class="token operator">&gt;</span>
<span class="token keyword">where</span>
    <span class="token lifetime-annotation symbol">&#39;b</span><span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">&#39;a</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">draw_light_mesh</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
        mesh<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token class-name">Mesh</span><span class="token punctuation">,</span>
        camera_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
        light_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">draw_light_mesh_instanced</span><span class="token punctuation">(</span>mesh<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">,</span> camera_bind_group<span class="token punctuation">,</span> light_bind_group<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">draw_light_mesh_instanced</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
        mesh<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token class-name">Mesh</span><span class="token punctuation">,</span>
        instances<span class="token punctuation">:</span> <span class="token class-name">Range</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        camera_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
        light_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">set_vertex_buffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> mesh<span class="token punctuation">.</span>vertex_buffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">set_index_buffer</span><span class="token punctuation">(</span>mesh<span class="token punctuation">.</span>index_buffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">IndexFormat</span><span class="token punctuation">::</span><span class="token class-name">Uint32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">set_bind_group</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> camera_bind_group<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">set_bind_group</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> light_bind_group<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">draw_indexed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span>mesh<span class="token punctuation">.</span>num_elements<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> instances<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">draw_light_model</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
        model<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token class-name">Model</span><span class="token punctuation">,</span>
        camera_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
        light_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">draw_light_model_instanced</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">,</span> camera_bind_group<span class="token punctuation">,</span> light_bind_group<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">draw_light_model_instanced</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
        model<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token class-name">Model</span><span class="token punctuation">,</span>
        instances<span class="token punctuation">:</span> <span class="token class-name">Range</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        camera_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
        light_bind_group<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;b</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroup</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> mesh <span class="token keyword">in</span> <span class="token operator">&amp;</span>model<span class="token punctuation">.</span>meshes <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">draw_light_mesh_instanced</span><span class="token punctuation">(</span>mesh<span class="token punctuation">,</span> instances<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> camera_bind_group<span class="token punctuation">,</span> light_bind_group<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åï¼Œåœ¨æ¸²æŸ“é€šé“ä¸­åŠ å…¥å…‰æºçš„æ¸²æŸ“ï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">impl</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
   <span class="token keyword">fn</span> <span class="token function-definition function">render</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">SurfaceError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        render_pass<span class="token punctuation">.</span><span class="token function">set_vertex_buffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>instance_buffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>model<span class="token punctuation">::</span></span><span class="token class-name">DrawLight</span><span class="token punctuation">;</span> <span class="token comment">// æ–°å¢!</span>
        render_pass<span class="token punctuation">.</span><span class="token function">set_pipeline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>light_render_pipeline<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–°å¢!</span>
        render_pass<span class="token punctuation">.</span><span class="token function">draw_light_model</span><span class="token punctuation">(</span>
            <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>obj_model<span class="token punctuation">,</span>
            <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>camera_bind_group<span class="token punctuation">,</span>
            <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>light_bind_group<span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–°å¢!</span>

        render_pass<span class="token punctuation">.</span><span class="token function">set_pipeline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>render_pipeline<span class="token punctuation">)</span><span class="token punctuation">;</span>
        render_pass<span class="token punctuation">.</span><span class="token function">draw_model_instanced</span><span class="token punctuation">(</span>
            <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>obj_model<span class="token punctuation">,</span>
            <span class="token number">0</span><span class="token punctuation">..</span><span class="token keyword">self</span><span class="token punctuation">.</span>instances<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
            <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>camera_bind_group<span class="token punctuation">,</span>
            <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>light_bind_group<span class="token punctuation">,</span> <span class="token comment">// æ–°å¢</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®Œæˆä¸Šé¢è¿™äº›åï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä¸‹æ¸²æŸ“æ•ˆæœï¼š</p><p><img src="/learn-wgpu-zh/assets/img/light-in-scene.9c827c41.png" alt="./light-in-scene.png"></p><h2 id="ç¯å¢ƒå…‰åå°„" tabindex="-1"><a class="header-anchor" href="#ç¯å¢ƒå…‰åå°„" aria-hidden="true">#</a> ç¯å¢ƒå…‰åå°„</h2><p>ç°å®ä¸–ç•Œä¸­ï¼Œå…‰çº¿åœ¨è¿›å…¥æˆ‘ä»¬çš„çœ¼ç›ä¹‹å‰å¾€å¾€åœ¨ç‰©ä½“è¡¨é¢ä¹‹é—´ç»å†äº†å¤šæ¬¡<strong>åå°„</strong>ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ èƒ½çœ‹è§é˜´å½±åŒºåŸŸçš„ä¸œè¥¿ã€‚åœ¨è®¡ç®—æœºä¸Šå®ç°è¿™ç§äº’åŠ¨æ¨¡å‹å¾ˆæ˜‚è´µï¼Œæ‰€ä»¥éœ€è¦â€œä½œå¼Šâ€ï¼ˆæ¨¡æ‹Ÿï¼‰ã€‚</p><p><strong>ç¯å¢ƒå…‰åå°„</strong>ï¼ˆAmbient Reflectionï¼‰å®šä¹‰äº†å¯¹è±¡è¡¨é¢æ‰€æœ‰ç‚¹çš„ç¯å¢ƒå…‰<strong>å¼ºåº¦</strong>ç›¸åŒï¼Œä»£è¡¨ä»åœºæ™¯çš„å…¶ä»–éƒ¨åˆ†åå°„è¿‡æ¥çš„å…‰ç…§äº®æˆ‘ä»¬çš„<strong>å¯¹è±¡</strong>ã€‚ ç¯å¢ƒå…‰åå°„å€¼ = å…‰æºé¢œè‰² * ç¯å¢ƒå…‰å¼ºåº¦ * ç‰‡å…ƒçš„é¢œè‰²ã€‚</p><p>è¯·åœ¨ <code>shader.wgsl</code> ä¸­çš„<strong>çº¹ç†</strong> Uniform ä¹‹ä¸‹æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token keyword">struct</span> <span class="token class-name">Light</span> <span class="token punctuation">{</span>
    position<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    color<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token punctuation">@</span><span class="token attributes attr-name">group</span><span class="token punctuation">(</span><span class="token int-literal number">2</span><span class="token punctuation">)</span> <span class="token punctuation">@</span><span class="token attributes attr-name">binding</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span>
<span class="token keyword">var</span><span class="token punctuation">&lt;</span><span class="token keyword">uniform</span><span class="token punctuation">&gt;</span> light<span class="token punctuation">:</span> <span class="token class-name">Light</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åæ›´æ–°ç‰‡å…ƒè‰²å™¨ä»£ç æ¥è®¡ç®—å’Œä½¿ç”¨ç¯å¢ƒå…‰çš„è‰²å€¼ï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token punctuation">@</span><span class="token attributes attr-name">fragment</span>
<span class="token keyword">fn</span> <span class="token functions function">fs_main</span><span class="token punctuation">(</span>in<span class="token punctuation">:</span> <span class="token class-name">VertexOutput</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> object_color<span class="token punctuation">:</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span> <span class="token operator">=</span> <span class="token builtin">textureSample</span><span class="token punctuation">(</span>t_diffuse<span class="token punctuation">,</span> s_diffuse<span class="token punctuation">,</span> in<span class="token punctuation">.</span>tex_coords<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// æˆ‘ä»¬ä¸éœ€è¦å¤ªå¼ºçš„ç¯å¢ƒå…‰ï¼Œå¼ºåº¦è®¾ç½®ä¸º 0.1 å°±å¤Ÿäº†</span>
    <span class="token keyword">let</span> ambient_strength <span class="token operator">=</span> <span class="token decimal-float-literal number">0.1</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> ambient_color <span class="token operator">=</span> light<span class="token punctuation">.</span>color <span class="token operator">*</span> ambient_strength<span class="token punctuation">;</span>

    <span class="token keyword">let</span> result <span class="token operator">=</span> ambient_color <span class="token operator">*</span> object_color<span class="token punctuation">.</span>rgb<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> object_color<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®Œæˆä¸Šé¢çš„ä¿®æ”¹åï¼Œæˆ‘ä»¬å°†å¾—åˆ°å¦‚ä¸‹æ¸²æŸ“æ•ˆæœï¼š</p><p><img src="/learn-wgpu-zh/assets/img/ambient_lighting.ffdb9822.png" alt="./ambient_lighting.png"></p><h2 id="æ¼«åå°„" tabindex="-1"><a class="header-anchor" href="#æ¼«åå°„" aria-hidden="true">#</a> æ¼«åå°„</h2><p>ç†æƒ³çš„<strong>æ¼«åå°„</strong>ï¼ˆDiffuse Reflectionï¼‰<strong>è¡¨é¢</strong>å°†å…‰çº¿å‘æ‰€æœ‰æ–¹å‘å‡åŒ€åœ°æ•£å°„ï¼Œå› æ­¤ï¼Œè¿™æ ·çš„è¡¨é¢åœ¨æ‰€æœ‰çš„è§‚å¯Ÿè€…çœ‹æ¥äº®åº¦éƒ½ä¸€æ ·ã€‚ä¸è¿‡ï¼Œåå°„å‡ºå»çš„å…‰çº¿å¼ºåº¦ä¾èµ–äº<strong>æè´¨</strong>ä»¥åŠå…‰æºç›¸å¯¹äºè¡¨é¢çš„ä½ç½®ã€‚</p><p>è¿˜è®°å¾—æˆ‘ä»¬çš„æ¨¡å‹ä¸­åŒ…å«çš„<strong>æ³•å‘é‡</strong>ï¼ˆNormal Vectorï¼‰å—ï¼Ÿç°åœ¨ç»ˆäºè¦ä½¿ç”¨å®ƒä»¬äº†ã€‚ <strong>æ³•å‘é‡</strong>ï¼ˆä¹Ÿå«åšæ³•çº¿ï¼‰ä»£è¡¨ä¸€ä¸ªè¡¨é¢çš„æœå‘ã€‚é€šè¿‡è®¡ç®—<strong>ç‰‡å…ƒ</strong>çš„æ³•å‘é‡å’Œå®ƒæŒ‡å‘å…‰æºçš„å‘é‡ä¹‹é—´çš„å¤¹è§’ï¼Œå¯ä»¥å¾—åˆ°è¯¥ç‰‡å…ƒ<strong>æ¼«åå°„</strong>å¼ºåº¦å€¼ã€‚æˆ‘ä»¬ä½¿ç”¨ç‚¹ç§¯æ¥è®¡ç®—å‘é‡ä¹‹é—´å¤¹è§’çš„<strong>ä½™å¼¦</strong>å€¼ï¼š</p><p><img src="/learn-wgpu-zh/assets/img/normal_diagram.9568a675.png" alt="./normal_diagram.png"></p><p>å¦‚æœ<strong>æ³•å‘é‡</strong>å’Œå…‰æºæ–¹å‘å‘é‡çš„ç‚¹ç§¯ä¸º 1.0ï¼Œåˆ™è¡¨ç¤ºå½“å‰ç‰‡å…ƒä¸å…‰æºå¯¹é½ï¼Œå°†åå°„å…‰çº¿çš„å…¨éƒ¨å¼ºåº¦ã€‚å€¼ä¸º 0 æˆ–æ›´ä½è¡¨ç¤ºè¡¨é¢å‚ç›´äºæˆ–è¿œç¦»å…‰æºï¼Œå› æ­¤åå°„å¼ºåº¦å°ã€‚</p><p>æˆ‘ä»¬å°†<strong>æ³•å‘é‡</strong>åŠ å…¥åˆ° <code>shader.wgsl</code> ä¸­ï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token keyword">struct</span> <span class="token class-name">VertexInput</span> <span class="token punctuation">{</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> position<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">1</span><span class="token punctuation">)</span> tex_coords<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">2</span><span class="token punctuation">)</span> normal<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// æ–°å¢!</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ç€å®šä¹‰è¯¥å€¼ä»¥åŠé¡¶ç‚¹çš„ä½ç½®æ¥ä¼ é€’ç»™ç‰‡å…ƒç€è‰²å™¨ï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token keyword">struct</span> <span class="token class-name">VertexOutput</span> <span class="token punctuation">{</span>
    <span class="token punctuation">@</span><span class="token builtin-attribute"><span class="token attribute attr-name">builtin</span><span class="token punctuation">(</span><span class="token built-in-values attr-value">position</span><span class="token punctuation">)</span></span> clip_position<span class="token punctuation">:</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> tex_coords<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">1</span><span class="token punctuation">)</span> world_normal<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">2</span><span class="token punctuation">)</span> world_position<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å…ˆæŒ‰åŸæ ·ä¼ é€’æ³•å‘é‡çš„å€¼ã€‚è¿™æ˜¯é”™è¯¯çš„ï¼Œç¨åä¼šä¿®å¤å®ƒï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token punctuation">@</span><span class="token attributes attr-name">vertex</span>
<span class="token keyword">fn</span> <span class="token functions function">vs_main</span><span class="token punctuation">(</span>
    model<span class="token punctuation">:</span> <span class="token class-name">VertexInput</span><span class="token punctuation">,</span>
    instance<span class="token punctuation">:</span> <span class="token class-name">InstanceInput</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">VertexOutput</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> model_matrix <span class="token operator">=</span> <span class="token builtin">mat4x4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span>
        instance<span class="token punctuation">.</span>model_matrix_0<span class="token punctuation">,</span>
        instance<span class="token punctuation">.</span>model_matrix_1<span class="token punctuation">,</span>
        instance<span class="token punctuation">.</span>model_matrix_2<span class="token punctuation">,</span>
        instance<span class="token punctuation">.</span>model_matrix_3<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> out<span class="token punctuation">:</span> <span class="token class-name">VertexOutput</span><span class="token punctuation">;</span>
    out<span class="token punctuation">.</span>tex_coords <span class="token operator">=</span> model<span class="token punctuation">.</span>tex_coords<span class="token punctuation">;</span>
    out<span class="token punctuation">.</span>world_normal <span class="token operator">=</span> model<span class="token punctuation">.</span>normal<span class="token punctuation">;</span>
    <span class="token keyword">var</span> world_position<span class="token punctuation">:</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span> <span class="token operator">=</span> model_matrix <span class="token operator">*</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>position<span class="token punctuation">,</span> <span class="token decimal-float-literal number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    out<span class="token punctuation">.</span>world_position <span class="token operator">=</span> world_position<span class="token punctuation">.</span>xyz<span class="token punctuation">;</span>
    out<span class="token punctuation">.</span>clip_position <span class="token operator">=</span> camera<span class="token punctuation">.</span>view_proj <span class="token operator">*</span> world_position<span class="token punctuation">;</span>
    <span class="token keyword">return</span> out<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨æ¥è¿›è¡Œå®é™…çš„è®¡ç®—ï¼Œåœ¨ <code>ambient_color</code> å’Œ <code>result</code> ä»£ç è¡Œä¹‹é—´ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token keyword">let</span> light_dir <span class="token operator">=</span> <span class="token builtin">normalize</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> in<span class="token punctuation">.</span>world_position<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> diffuse_strength <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token builtin">dot</span><span class="token punctuation">(</span>in<span class="token punctuation">.</span>world_normal<span class="token punctuation">,</span> light_dir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token decimal-float-literal number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> diffuse_color <span class="token operator">=</span> light<span class="token punctuation">.</span>color <span class="token operator">*</span> diffuse_strength<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶ååœ¨ <code>result</code> ä¸­åŒ…å«æ¼«åå°„å…‰ï¼ˆ<code>diffuse_color</code>ï¼‰:</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">(</span>ambient_color <span class="token operator">+</span> diffuse_color<span class="token punctuation">)</span> <span class="token operator">*</span> object_color<span class="token punctuation">.</span>xyz<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å®Œæˆåï¼Œæˆ‘ä»¬å°†è·å¾—å¦‚ä¸‹æ¸²æŸ“æ•ˆæœï¼š</p><p><img src="/learn-wgpu-zh/assets/img/ambient_diffuse_wrong.d284c375.png" alt="./ambient_diffuse_wrong.png"></p><h2 id="æ³•çº¿çŸ©é˜µ" tabindex="-1"><a class="header-anchor" href="#æ³•çº¿çŸ©é˜µ" aria-hidden="true">#</a> æ³•çº¿çŸ©é˜µ</h2><p>è¿˜è®°å¾—æˆ‘è¯´è¿‡å°†é¡¶ç‚¹<strong>æ³•å‘é‡</strong>ç›´æ¥ä¼ é€’ç»™ç‰‡å…ƒç€è‰²å™¨æ˜¯é”™è¯¯çš„å—ï¼Ÿæˆ‘ä»¬é€šè¿‡åªåœ¨åœºæ™¯ä¸­ä¿ç•™ä¸€ä¸ªåœ¨ y è½´ä¸Šæ—‹è½¬äº† 180 åº¦çš„ç«‹æ–¹ä½“æ¥æ¢ç´¢è¿™ä¸€ç‚¹ï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">const</span> <span class="token constant">NUM_INSTANCES_PER_ROW</span><span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">// In the loop we create the instances in</span>
<span class="token keyword">let</span> rotation <span class="token operator">=</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Quaternion</span><span class="token punctuation">::</span><span class="token function">from_axis_angle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Deg</span><span class="token punctuation">(</span><span class="token number">180.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŒæ—¶ä» <code>result</code> ä¸­ç§»é™¤ç¯å¢ƒå…‰ <code>ambient_color</code>ï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">(</span>diffuse_color<span class="token punctuation">)</span> <span class="token operator">*</span> object_color<span class="token punctuation">.</span>xyz<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æˆ‘ä»¬å°†å¾—åˆ°å¦‚ä¸‹æ¸²æŸ“æ•ˆæœï¼š</p><p><img src="/learn-wgpu-zh/assets/img/diffuse_wrong.acdef06e.png" alt="./diffuse_wrong.png"></p><p>æ¸²æŸ“ç»“æœæ˜¾ç„¶æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºå…‰çº¿ç…§äº®äº†ç«‹æ–¹ä½“çš„èƒŒå…‰ä¾§ã€‚è¿™æ˜¯ç”±äº<strong>æ³•å‘é‡</strong>å¹¶æ²¡æœ‰éšå¯¹è±¡ä¸€èµ·æ—‹è½¬ï¼Œå› æ­¤æ— è®ºå¯¹è±¡è½¬å‘å“ªä¸ªæ–¹å‘ï¼Œæ³•å‘é‡çš„æ–¹å‘å§‹ç»ˆæ²¡å˜ï¼š</p><p><img src="data:image/png;base64,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AAACBABAgAAACBAAAAECACBAAAAgQAAABAgAgAABABAgAAACBAAAAgQAQIAAAAgQAAABAgAgQAAAIEAAAAQIAIAAAQAQIAAAAgQAAAIEAECAAAAIEAAAAQIAIEAAACBAAAAECACAAAEAECAAABAgAAACBABAgAAACBAAAAECAAABAgAgQAAABAgAgAABABAgAAAQIAAAAgQAQIAAAAgQAAABAgAAAQIAIEAAAAQIAIAAAQAQIAAAECAAAAIEAECAAAAIEAAAAQIAAAECACBAAAAECACAAAEAECAAABAgAAACBABAgAAACBAAAAHCFAAACBAAAAECACBAAAAECAAABAgAgAABABAgAAACBABAgAAAQIAAAAgQAAABAgAgQAAABAgAAAQIAIAAAQAQIAAAAgQAQIAAAECAAAAIEAAAAQIAIEAAAAQIAAAECACAAAEAECAAAAIEAECAAABAgAAACBAAAAECACBAAAAECAAABAgAgAABABAgAAACBAAAAgQAQIAAAAgQAAABAgAgQAAAIEAAAAQIAIAAAQAQIAAAAgQAAAIEAECAAAAIEAAAAQIAIEAAACBAAAAECACAAAEAECAAAAIEAAACBABAgAAACBAAAAECACBAAAAgQAAABAgAgAABABAgAAACBAAAAgQAQIAAAAgQAAABAgAgQAAAIEAAAAQIAIAAAQAQIAAAECAAAAIEAECAAAAIEAAAAQIAAAECACBAAACe8f8Iph1tvtY2iAAAAABJRU5ErkJggg==" alt="./normal_not_rotated.png"></p><p>æˆ‘ä»¬å°†ä½¿ç”¨<strong>æ³•çº¿çŸ©é˜µ</strong>ï¼ˆNormal Matrixï¼‰å°†<strong>æ³•å‘é‡</strong>å˜æ¢ä¸ºæ­£ç¡®çš„æ–¹å‘ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ³•å‘é‡è¡¨ç¤ºä¸€ä¸ªæ–¹å‘ï¼Œå®ƒåº”è¯¥åšä¸º<strong>å•ä½å‘é‡</strong>ï¼ˆUnit Vectorï¼‰æ¥å‚ä¸æ•´ä¸ªè®¡ç®—è¿‡ç¨‹ã€‚</p><p>è™½ç„¶å¯ä»¥åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­è®¡ç®—<strong>æ³•çº¿çŸ©é˜µ</strong>ï¼Œä½†è¿™æ¶‰åŠåˆ°åè½¬æ¨¡å‹çŸ©é˜µ <code>model_matrix</code>ï¼Œè€Œ WGSL å®é™…ä¸Šæ²¡æœ‰çŸ©é˜µæ±‚é€†çš„å‡½æ•°ï¼Œå¿…é¡»è‡ªå·±ç¼–å†™æ­¤ä»£ç ã€‚æ›´é‡è¦çš„æ˜¯ï¼ŒçŸ©é˜µæ±‚é€†çš„è®¡ç®—åœ¨ç€è‰²å™¨é‡Œå®é™…ä¸Šéå¸¸æ˜‚è´µï¼Œç‰¹åˆ«æ˜¯æ¯ä¸ªé¡¶ç‚¹éƒ½è¦è®¡ç®—ä¸€éã€‚</p><p>æˆ‘ä»¬çš„æ›¿ä»£æ–¹æ¡ˆæ˜¯ï¼Œå‘ <code>InstanceRaw</code> ç»“æ„ä½“æ·»åŠ ä¸€ä¸ª <code>normal</code> å­—æ®µã€‚ä¸ç”¨å»åè½¬<strong>æ¨¡å‹çŸ©é˜µ</strong>ï¼Œè€Œæ˜¯ä½¿ç”¨æ¨¡å‹å®ä¾‹çš„æ—‹è½¬æ¥åˆ›å»ºä¸€ä¸ª <code>Matrix3</code> ç±»å‹çš„æ³•çº¿çŸ©é˜µã€‚</p><div class="note"><p>æˆ‘ä»¬åªéœ€è¦ç”¨åˆ°çŸ©é˜µçš„æ—‹è½¬åˆ†é‡ï¼Œæ•…<strong>æ³•çº¿çŸ©é˜µ</strong>çš„ç±»å‹æ˜¯ <code>Matrix3</code> è€Œä¸æ˜¯ <code>Matrix4</code>ã€‚</p></div><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[repr(C)]</span>
<span class="token attribute attr-name">#[derive(Debug, Copy, Clone, bytemuck::Pod, bytemuck::Zeroable)]</span>
<span class="token attribute attr-name">#[allow(dead_code)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">InstanceRaw</span> <span class="token punctuation">{</span>
    model<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    normal<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token namespace">model<span class="token punctuation">::</span></span><span class="token class-name">Vertex</span> <span class="token keyword">for</span> <span class="token class-name">InstanceRaw</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">desc</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;a</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexBufferLayout</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;a</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>mem<span class="token punctuation">;</span>
        <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexBufferLayout</span> <span class="token punctuation">{</span>
            array_stride<span class="token punctuation">:</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">InstanceRaw</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferAddress</span><span class="token punctuation">,</span>
            <span class="token comment">// step_mode çš„å€¼éœ€è¦ä» Vertex æ”¹ä¸º Instance</span>
            <span class="token comment">// è¿™æ„å‘³ç€åªæœ‰ç€è‰²å™¨å¼€å§‹å¤„ç†ä¸€æ¬¡æ–°å®ä¾‹åŒ–ç»˜åˆ¶æ—¶ï¼Œæ‰ä¼šä½¿ç”¨ä¸‹ä¸€ä¸ªå®ä¾‹æ•°æ®</span>
            step_mode<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexStepMode</span><span class="token punctuation">::</span><span class="token class-name">Instance</span><span class="token punctuation">,</span>
            attributes<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
                <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexAttribute</span> <span class="token punctuation">{</span>
                    offset<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    <span class="token comment">// è™½ç„¶é¡¶ç‚¹ç€è‰²å™¨ç°åœ¨åªä½¿ç”¨äº†æ’æ§½ 0 å’Œ 1ï¼Œä½†åœ¨åé¢çš„æ•™ç¨‹ä¸­å°†ä¼šä½¿ç”¨ 2ã€3 å’Œ 4</span>
                    <span class="token comment">// æ­¤å¤„ä»æ’æ§½ 5 å¼€å§‹ï¼Œç¡®ä¿ä¸åé¢çš„æ•™ç¨‹ä¸ä¼šæœ‰å†²çª</span>
                    shader_location<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
                    format<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexFormat</span><span class="token punctuation">::</span><span class="token class-name">Float32x4</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">// mat4 ä»æŠ€æœ¯çš„è§’åº¦æ¥çœ‹æ˜¯ç”± 4 ä¸ª vec4 æ„æˆï¼Œå ç”¨ 4 ä¸ªæ’æ§½ã€‚</span>
                <span class="token comment">// æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ª vec4 å®šä¹‰ä¸€ä¸ªæ’æ§½ï¼Œç„¶ååœ¨ç€è‰²å™¨ä¸­é‡æ–°ç»„è£…å‡º mat4ã€‚</span>
                <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexAttribute</span> <span class="token punctuation">{</span>
                    offset<span class="token punctuation">:</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferAddress</span><span class="token punctuation">,</span>
                    shader_location<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
                    format<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexFormat</span><span class="token punctuation">::</span><span class="token class-name">Float32x4</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexAttribute</span> <span class="token punctuation">{</span>
                    offset<span class="token punctuation">:</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferAddress</span><span class="token punctuation">,</span>
                    shader_location<span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
                    format<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexFormat</span><span class="token punctuation">::</span><span class="token class-name">Float32x4</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexAttribute</span> <span class="token punctuation">{</span>
                    offset<span class="token punctuation">:</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferAddress</span><span class="token punctuation">,</span>
                    shader_location<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
                    format<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexFormat</span><span class="token punctuation">::</span><span class="token class-name">Float32x4</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">// æ–°å¢!</span>
                <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexAttribute</span> <span class="token punctuation">{</span>
                    offset<span class="token punctuation">:</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">16</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferAddress</span><span class="token punctuation">,</span>
                    shader_location<span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
                    format<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexFormat</span><span class="token punctuation">::</span><span class="token class-name">Float32x3</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexAttribute</span> <span class="token punctuation">{</span>
                    offset<span class="token punctuation">:</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">19</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferAddress</span><span class="token punctuation">,</span>
                    shader_location<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
                    format<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexFormat</span><span class="token punctuation">::</span><span class="token class-name">Float32x3</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexAttribute</span> <span class="token punctuation">{</span>
                    offset<span class="token punctuation">:</span> <span class="token namespace">mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">22</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferAddress</span><span class="token punctuation">,</span>
                    shader_location<span class="token punctuation">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
                    format<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexFormat</span><span class="token punctuation">::</span><span class="token class-name">Float32x3</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åä¿®æ”¹ <code>Instance</code> ä»¥åˆ›å»ºæ³•çº¿çŸ©é˜µï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">struct</span> <span class="token type-definition class-name">Instance</span> <span class="token punctuation">{</span>
    position<span class="token punctuation">:</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Vector3</span><span class="token operator">&lt;</span><span class="token keyword">f32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    rotation<span class="token punctuation">:</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Quaternion</span><span class="token operator">&lt;</span><span class="token keyword">f32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Instance</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">to_raw</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">InstanceRaw</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> model <span class="token operator">=</span>
            <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Matrix4</span><span class="token punctuation">::</span><span class="token function">from_translation</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>position<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Matrix4</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>rotation<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">InstanceRaw</span> <span class="token punctuation">{</span>
            model<span class="token punctuation">:</span> model<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// æ–°å¢!</span>
            normal<span class="token punctuation">:</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Matrix3</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>rotation<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­é‡æ„æ³•çº¿çŸ©é˜µï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token keyword">struct</span> <span class="token class-name">InstanceInput</span> <span class="token punctuation">{</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">5</span><span class="token punctuation">)</span> model_matrix_0<span class="token punctuation">:</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">6</span><span class="token punctuation">)</span> model_matrix_1<span class="token punctuation">:</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">7</span><span class="token punctuation">)</span> model_matrix_2<span class="token punctuation">:</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">8</span><span class="token punctuation">)</span> model_matrix_3<span class="token punctuation">:</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
    <span class="token comment">// æ–°å¢!</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">9</span><span class="token punctuation">)</span> normal_matrix_0<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">10</span><span class="token punctuation">)</span> normal_matrix_1<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">11</span><span class="token punctuation">)</span> normal_matrix_2<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">VertexOutput</span> <span class="token punctuation">{</span>
    <span class="token punctuation">@</span><span class="token builtin-attribute"><span class="token attribute attr-name">builtin</span><span class="token punctuation">(</span><span class="token built-in-values attr-value">position</span><span class="token punctuation">)</span></span> clip_position<span class="token punctuation">:</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> tex_coords<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">1</span><span class="token punctuation">)</span> world_normal<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">2</span><span class="token punctuation">)</span> world_position<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">@</span><span class="token attributes attr-name">vertex</span>
<span class="token keyword">fn</span> <span class="token functions function">vs_main</span><span class="token punctuation">(</span>
    model<span class="token punctuation">:</span> <span class="token class-name">VertexInput</span><span class="token punctuation">,</span>
    instance<span class="token punctuation">:</span> <span class="token class-name">InstanceInput</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">VertexOutput</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> model_matrix <span class="token operator">=</span> <span class="token builtin">mat4x4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span>
        instance<span class="token punctuation">.</span>model_matrix_0<span class="token punctuation">,</span>
        instance<span class="token punctuation">.</span>model_matrix_1<span class="token punctuation">,</span>
        instance<span class="token punctuation">.</span>model_matrix_2<span class="token punctuation">,</span>
        instance<span class="token punctuation">.</span>model_matrix_3<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ–°å¢!</span>
    <span class="token keyword">let</span> normal_matrix <span class="token operator">=</span> <span class="token builtin">mat3x3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span>
        instance<span class="token punctuation">.</span>normal_matrix_0<span class="token punctuation">,</span>
        instance<span class="token punctuation">.</span>normal_matrix_1<span class="token punctuation">,</span>
        instance<span class="token punctuation">.</span>normal_matrix_2<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> out<span class="token punctuation">:</span> <span class="token class-name">VertexOutput</span><span class="token punctuation">;</span>
    out<span class="token punctuation">.</span>tex_coords <span class="token operator">=</span> model<span class="token punctuation">.</span>tex_coords<span class="token punctuation">;</span>
    out<span class="token punctuation">.</span>world_normal <span class="token operator">=</span> normal_matrix <span class="token operator">*</span> model<span class="token punctuation">.</span>normal<span class="token punctuation">;</span> <span class="token comment">// UPDATED!</span>
    <span class="token keyword">var</span> world_position<span class="token punctuation">:</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span> <span class="token operator">=</span> model_matrix <span class="token operator">*</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>position<span class="token punctuation">,</span> <span class="token decimal-float-literal number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    out<span class="token punctuation">.</span>world_position <span class="token operator">=</span> world_position<span class="token punctuation">.</span>xyz<span class="token punctuation">;</span>
    out<span class="token punctuation">.</span>clip_position <span class="token operator">=</span> camera<span class="token punctuation">.</span>view_proj <span class="token operator">*</span> world_position<span class="token punctuation">;</span>
    <span class="token keyword">return</span> out<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="note"><p>ä¸Šè¾¹çš„å®ç°æ˜¯åŸºäº <a href="https://gamedev.stackexchange.com/questions/65783/what-are-world-space-and-eye-space-in-game-development" target="_blank" rel="noopener noreferrer">ä¸–ç•Œç©ºé—´<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> çš„ã€‚åœ¨<strong>è§†å›¾ç©ºé—´</strong>ï¼ˆview-spaceï¼‰ï¼Œä¹Ÿå°±æ˜¯<strong>çœ¼ç©ºé—´</strong>ï¼ˆeye-spaceï¼‰æ¥å®ç°æ˜¯æ›´æ ‡å‡†çš„åšæ³•ï¼Œå› ä¸ºå¯¹è±¡åœ¨ç¦»<strong>åŸç‚¹</strong>è¾ƒè¿œçš„åœ°æ–¹ä¼šäº§ç”Ÿå…‰ç…§é—®é¢˜ã€‚ å¦‚æœæ”¹ä¸ºä½¿ç”¨è§†å›¾ç©ºé—´ï¼Œå°±éœ€è¦åŒ…æ‹¬ç”±<strong>è§†å›¾çŸ©é˜µ</strong>äº§ç”Ÿçš„æ—‹è½¬ã€‚è¿˜é¡»ä½¿ç”¨ <code>view_matrix * model_matrix * light_position</code> æ¥å˜æ¢å…‰æºçš„ä½ç½®ï¼Œä»¥é˜²æ­¢æ‘„åƒæœºç§»åŠ¨åäº§ç”Ÿè®¡ç®—é”™è¯¯ã€‚</p><p>ä½¿ç”¨è§†å›¾ç©ºé—´çš„æœ€å¤§ä¼˜åŠ¿æ˜¯ï¼šèƒ½é¿å…åœ¨å¤§è§„æ¨¡çš„åœºæ™¯ä¸­è¿›è¡Œ<strong>å…‰ç…§</strong>å’Œå…¶ä»–è®¡ç®—æ—¶ï¼Œç”±äº<strong>å¯¹è±¡</strong>ä¹‹é—´çš„ç©ºé—´é—´è·å¯¼è‡´çš„é—®é¢˜ã€‚ å› ä¸ºå½“æ•°å­—å˜å¾—éå¸¸å¤§æ—¶ï¼Œæµ®ç‚¹æ•°ç²¾åº¦ä¼šä¸‹é™ã€‚è§†å›¾ç©ºé—´ä½¿æ‘„åƒæœºä¿æŒåœ¨<strong>åŸç‚¹</strong>ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰çš„è®¡ç®—éƒ½ä¼šä½¿ç”¨è¾ƒå°çš„æ•°å­—ã€‚ æœ€ç»ˆçš„å…‰ç…§è®¡ç®—è¿‡ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯éœ€è¦å¤šä¸€ç‚¹ç‚¹è®¾ç½®ã€‚</p></div><p>ç»è¿‡ä»¥ä¸Šä¿®æ”¹ï¼Œå…‰ç…§æ•ˆæœç°åœ¨çœ‹èµ·æ¥å·²ç»æ­£ç¡®äº†ï¼š</p><p><img src="/learn-wgpu-zh/assets/img/diffuse_right.ba11ebcf.png" alt="./diffuse_right.png"></p><p>ç°åœ¨æŠŠåœºæ™¯ä¸­å…¶ä»–<strong>å¯¹è±¡</strong>åŠ å›æ¥ï¼Œå†åŠ ä¸Š<strong>ç¯å¢ƒå…‰åå°„</strong>ï¼Œæˆ‘ä»¬å°±ä¼šå¾—åˆ°å¦‚ä¸‹æ¸²æŸ“æ•ˆæœï¼š</p><p><img src="/learn-wgpu-zh/assets/img/ambient_diffuse_lighting.11ee73c6.png" alt="./ambient_diffuse_lighting.png"></p><div class="note"><p>å¦‚æœèƒ½ä¿è¯<strong>æ¨¡å‹çŸ©é˜µ</strong>æ€»æ˜¯å¯¹<strong>å¯¹è±¡</strong>åº”ç”¨ç»Ÿä¸€çš„ç¼©æ”¾å› å­ï¼Œä½ å°±å¯ä»¥åªä½¿ç”¨æ¨¡å‹çŸ©é˜µäº†ã€‚Github ç”¨æˆ· @julhe ä¸æˆ‘åˆ†äº«çš„è¿™æ®µä»£ç å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code>out<span class="token punctuation">.</span>world_normal <span class="token operator">=</span> <span class="token punctuation">(</span>model_matrix <span class="token operator">*</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>normal<span class="token punctuation">,</span> <span class="token decimal-float-literal number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xyz<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä»–åˆ©ç”¨çš„æ˜¯è¿™æ ·ä¸€ä¸ªäº‹å®ï¼šå³ç”¨ä¸€ä¸ª 4x4 çŸ©é˜µä¹˜ä»¥ä¸€ä¸ª w åˆ†é‡ä¸º 0 çš„å‘é‡æ—¶ï¼Œåªæœ‰æ—‹è½¬å’Œç¼©æ”¾å°†è¢«åº”ç”¨äºå‘é‡ã€‚ ä¸è¿‡ä½ éœ€è¦å¯¹è¿™ä¸ªå‘é‡è¿›è¡Œ<strong>å½’ä¸€åŒ–</strong>ï¼ˆNormalizeï¼‰å¤„ç†ï¼Œå› ä¸ºæ³•å‘é‡å¿…é¡»æ˜¯<strong>å•ä½å‘é‡</strong>ã€‚</p><p>æ¨¡å‹çŸ©é˜µçš„ç¼©æ”¾å› å­<em>å¿…é¡»</em>æ˜¯ç»Ÿä¸€çš„æ‰èƒ½é€‚ç”¨ã€‚å¦åˆ™äº§ç”Ÿçš„æ³•å‘é‡å°†æ˜¯å€¾æ–œäºè¡¨é¢çš„ï¼Œå¦‚ä¸‹å›¾ç‰‡æ‰€ç¤ºï¼š</p><p><img src="/learn-wgpu-zh/assets/img/normal-scale-issue.a60633c1.png" alt="./normal-scale-issue.png"></p></div><h2 id="é•œé¢åå°„" tabindex="-1"><a class="header-anchor" href="#é•œé¢åå°„" aria-hidden="true">#</a> é•œé¢åå°„</h2><p><strong>é•œé¢åå°„</strong>ï¼ˆSpecular Reflectionï¼‰æ¨¡æ‹Ÿäº†ç°å®ä¸–ç•Œä¸­ä»ç‰¹å®šè§’åº¦è§‚å¯Ÿç‰©ä½“æ—¶å‡ºç°çš„<strong>é«˜å…‰</strong>ï¼ˆHighlightsï¼Œäº®ç‚¹ï¼‰ã€‚ å¦‚æœæ›¾åœ¨é˜³å…‰ä¸‹è§‚å¯Ÿè¿‡æ±½è½¦ï¼Œå®šä¼šæ³¨æ„åˆ°è½¦èº«å‡ºç°çš„é«˜äº®éƒ¨åˆ†ã€‚åŸºæœ¬ä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬åœ¨è§‚å¯Ÿæœ‰å…‰æ³½çš„ç‰©ä½“æ—¶å°±ä¼šçœ‹åˆ°<strong>é«˜å…‰</strong>ã€‚ ä»è¡¨é¢å…‰æ»‘çš„ç‰©ä½“ä¸Šåå°„å‡ºå»çš„å…‰çº¿ä¼šå€¾å‘äºé›†ä¸­åœ¨ä¸€ä¸ªè§’åº¦çš„é™„è¿‘ï¼Œæ‰€ä»¥é«˜å…‰çš„ä½ç½®ä¼šæ ¹æ®ä½ è§‚å¯Ÿçš„è§’åº¦è€Œå˜åŒ–ã€‚</p><p><img src="/learn-wgpu-zh/assets/img/specular_diagram.4038dfe3.png" alt="./specular_diagram.png"></p><p>å› ä¸º<strong>é•œé¢åå°„</strong>æ˜¯ç›¸å¯¹äºè§†è§’è€Œè¨€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†æ‘„åƒæœºçš„ä½ç½®ä¼ å…¥é¡¶ç‚¹åŠç‰‡å…ƒç€è‰²å™¨ä¸­ï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token keyword">struct</span> <span class="token class-name">Camera</span> <span class="token punctuation">{</span>
    view_pos<span class="token punctuation">:</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    view_proj<span class="token punctuation">:</span> <span class="token builtin">mat4x4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token punctuation">@</span><span class="token attributes attr-name">group</span><span class="token punctuation">(</span><span class="token int-literal number">1</span><span class="token punctuation">)</span> <span class="token punctuation">@</span><span class="token attributes attr-name">binding</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span>
<span class="token keyword">var</span><span class="token punctuation">&lt;</span><span class="token keyword">uniform</span><span class="token punctuation">&gt;</span> camera<span class="token punctuation">:</span> <span class="token class-name">Camera</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="note"><p>åˆ«å¿˜äº†ä¹Ÿè¦æ›´æ–° <code>light.wgsl</code> ä¸­çš„ <code>Camera</code> ç»“æ„ä½“ï¼Œä¸€æ—¦å®ƒä¸ Rust ä¸­çš„ <code>CameraUniform</code> ç»“æ„ä½“ä¸åŒ¹é…ï¼Œå…‰ç…§æ•ˆæœå°±ä¼šæ¸²æŸ“é”™è¯¯ã€‚</p></div><p>åŒæ—¶ä¹Ÿéœ€è¦æ›´æ–° <code>CameraUniform</code> ç»“æ„ä½“ï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// lib.rs</span>
<span class="token attribute attr-name">#[repr(C)]</span>
<span class="token attribute attr-name">#[derive(Copy, Clone, bytemuck::Pod, bytemuck::Zeroable)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">CameraUniform</span> <span class="token punctuation">{</span>
    view_position<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    view_proj<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">CameraUniform</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">Self</span> <span class="token punctuation">{</span>
            view_position<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            view_proj<span class="token punctuation">:</span> <span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Matrix4</span><span class="token punctuation">::</span><span class="token function">identity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">update_view_proj</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> camera<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Camera</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä½¿ç”¨ vec4 çº¯ç²¹æ˜¯å› ä¸º Uniform çš„ 16 å­—èŠ‚å¯¹é½è¦æ±‚</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>view_position <span class="token operator">=</span> camera<span class="token punctuation">.</span>eye<span class="token punctuation">.</span><span class="token function">to_homogeneous</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>view_proj <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token constant">OPENGL_TO_WGPU_MATRIX</span> <span class="token operator">*</span> camera<span class="token punctuation">.</span><span class="token function">build_view_projection_matrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äºç°åœ¨è¦åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­ä½¿ç”¨ Uniformï¼Œå¾—ä¿®æ”¹å®ƒçš„å¯è§æ€§ï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// lib.rs</span>
<span class="token keyword">let</span> camera_bind_group_layout <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_bind_group_layout</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupLayoutDescriptor</span> <span class="token punctuation">{</span>
    entries<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
        <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupLayoutBinding</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
            visibility<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderStages</span><span class="token punctuation">::</span><span class="token constant">VERTEX</span> <span class="token operator">|</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderStages</span><span class="token punctuation">::</span><span class="token constant">FRAGMENT</span><span class="token punctuation">,</span> <span class="token comment">// æ›´æ–°!</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    label<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è®¡ç®—ä»ç‰‡å…ƒä½ç½®åˆ°æ‘„åƒæœºçš„<strong>æ–¹å‘å‘é‡</strong>ï¼Œå¹¶ç”¨æ­¤å‘é‡å’Œæ³•å‘é‡æ¥è®¡ç®—åå°„æ–¹å‘ <code>reflect_dir</code>ï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token comment">// shader.wgsl</span>
<span class="token comment">// ç‰‡å…ƒç€è‰²å™¨å†…...</span>
<span class="token keyword">let</span> view_dir <span class="token operator">=</span> <span class="token builtin">normalize</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>view_pos<span class="token punctuation">.</span>xyz <span class="token operator">-</span> in<span class="token punctuation">.</span>world_position<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> reflect_dir <span class="token operator">=</span> <span class="token builtin">reflect</span><span class="token punctuation">(</span><span class="token operator">-</span>light_dir<span class="token punctuation">,</span> in<span class="token punctuation">.</span>world_normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åä½¿ç”¨<strong>ç‚¹ç§¯</strong>æ¥è®¡ç®—é•œé¢åå°„çš„å¼ºåº¦ <code>specular_strength</code>ï¼Œå¹¶ç”¨å®ƒç®—å‡ºé«˜å…‰é¢œè‰² <code>specular_color</code>ï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token keyword">let</span> specular_strength <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token builtin">dot</span><span class="token punctuation">(</span>view_dir<span class="token punctuation">,</span> reflect_dir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token decimal-float-literal number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token decimal-float-literal number">32.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> specular_color <span class="token operator">=</span> specular_strength <span class="token operator">*</span> light<span class="token punctuation">.</span>color<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åï¼Œå°†é«˜å…‰é¢œè‰²åˆæˆåˆ°ç‰‡å…ƒè¾“å‡ºç»“æœä¸­ï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">(</span>ambient_color <span class="token operator">+</span> diffuse_color <span class="token operator">+</span> specular_color<span class="token punctuation">)</span> <span class="token operator">*</span> object_color<span class="token punctuation">.</span>xyz<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å®Œæˆå…¨éƒ¨ä»£ç ä¹‹åï¼Œå°±èƒ½å¾—åˆ°å¦‚ä¸‹æ¸²æŸ“æ•ˆæœï¼š</p><p><img src="/learn-wgpu-zh/assets/img/ambient_diffuse_specular_lighting.9006736d.png" alt="./ambient_diffuse_specular_lighting.png"></p><p>å‡å¦‚åªæŸ¥çœ‹é•œé¢åå°„å¾—åˆ°çš„é«˜å…‰é¢œè‰² <code>specular_color</code> æœ¬èº«ï¼Œæ¸²æŸ“æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="/learn-wgpu-zh/assets/img/specular_lighting.bf2cb9cb.png" alt="./specular_lighting.png"></p><h2 id="åŠç¨‹å‘é‡" tabindex="-1"><a class="header-anchor" href="#åŠç¨‹å‘é‡" aria-hidden="true">#</a> åŠç¨‹å‘é‡</h2><p>æ‰€è°“çš„<strong>åŠç¨‹å‘é‡</strong>ï¼ˆHalfway Vectorï¼‰ä¹Ÿæ˜¯ä¸€ä¸ªå•ä½å‘é‡ï¼Œå®ƒæ­£å¥½åœ¨è§†å›¾æ–¹å‘å’Œå…‰æºæ–¹å‘çš„ä¸­é—´ã€‚</p><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å®é™…ä¸Šåªå®ç°äº† Blinn-Phong çš„ Phong éƒ¨åˆ†ã€‚Phong åå°„æ¨¡å‹å¾ˆå¥½ç”¨ï¼Œä½†åœ¨<a href="https://learnopengl.com/Advanced-Lighting/Advanced-Lighting" target="_blank" rel="noopener noreferrer">æŸäº›æƒ…å†µä¸‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ä¼šäº§ç”Ÿ bugã€‚ Blinn-Phong çš„ Blinn éƒ¨åˆ†æ¥è‡ªäºè¿™æ ·çš„äº‹å®ï¼šå¦‚æœæŠŠ <code>view_dir</code> å’Œ <code>light_dir</code> åŠ åœ¨ä¸€èµ·ï¼Œå¯¹ç»“æœè¿›è¡Œ<strong>å½’ä¸€åŒ–</strong>å¤„ç†åå¾—åˆ°ä¸€ä¸ª<strong>åŠç¨‹å‘é‡</strong>ï¼Œç„¶åå†ä¸æ³•å‘é‡ <code>normal</code> æ±‚ç‚¹ç§¯ï¼Œå°±ä¼šå¾—åˆ°å¤§è‡´ç›¸åŒçš„æ¸²æŸ“ç»“æœï¼Œä¸”ä¸ä¼šæœ‰ä½¿ç”¨åå°„æ–¹å‘ <code>reflect_dir</code> å¯èƒ½äº§ç”Ÿçš„é—®é¢˜ã€‚</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token keyword">let</span> view_dir <span class="token operator">=</span> <span class="token builtin">normalize</span><span class="token punctuation">(</span>camera<span class="token punctuation">.</span>view_pos<span class="token punctuation">.</span>xyz <span class="token operator">-</span> in<span class="token punctuation">.</span>world_position<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> half_dir <span class="token operator">=</span> <span class="token builtin">normalize</span><span class="token punctuation">(</span>view_dir <span class="token operator">+</span> light_dir<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> specular_strength <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token builtin">dot</span><span class="token punctuation">(</span>in<span class="token punctuation">.</span>world_normal<span class="token punctuation">,</span> half_dir<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token decimal-float-literal number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token decimal-float-literal number">32.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æˆ‘ä»¬è¿™ä¸ªåœºæ™¯ä¸‹å¾ˆéš¾çœ‹å‡ºæœ‰ä½•ä¸åŒï¼Œä½†ä»¥ä¸‹å°±æ˜¯æ”¹è¿›äº†å…‰ç…§è®¡ç®—åçš„æ¸²æŸ“æ•ˆæœï¼š</p><p><img src="/learn-wgpu-zh/assets/img/half_dir.a2e2d5c3.png" alt="./half_dir.png"></p><div id="wasm-example"><!----><button>Try Tutorial10_lighting!</button></div><div class="auto-github-link"><a href="https://github.com/jinleili/learn-wgpu-zh/tree/master/code/intermediate/tutorial10-lighting/" target="_blank" rel="noopener noreferrer"> &quot;æŸ¥çœ‹æºç ï¼&quot; </a><!----></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">ä¸Šæ¬¡æ›´æ–°: </span><!----></div><!----></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/learn-wgpu-zh/intermediate/tutorial11-normals/" class="" aria-label="æ³•çº¿æ˜ å°„"><!--[--><!--]--> æ³•çº¿æ˜ å°„ <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/learn-wgpu-zh/assets/js/runtime~app.1fe6cd89.js" defer></script><script src="/learn-wgpu-zh/assets/js/3866.84df6019.js" defer></script><script src="/learn-wgpu-zh/assets/js/app.986ad84b.js" defer></script>
  </body>
</html>
