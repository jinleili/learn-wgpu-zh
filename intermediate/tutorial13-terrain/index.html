<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>ç¨‹åºåœ°å½¢ | å­¦ä¹  wgpu</title><meta name="description" content="ä½¿ç”¨ Rust å­¦ä¹  wgpu">
    <link rel="preload" href="/learn-wgpu-zh/assets/js/runtime~app.1fe6cd89.js" as="script"><link rel="preload" href="/learn-wgpu-zh/assets/css/styles.dbd69ac3.css" as="style"><link rel="preload" href="/learn-wgpu-zh/assets/js/3866.84df6019.js" as="script"><link rel="preload" href="/learn-wgpu-zh/assets/js/app.986ad84b.js" as="script"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-2d69bb60.97588166.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-bfc81dd6.ca69855e.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-4249d10f.bc14afad.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-82a25e06.afd792d8.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-2168b6f4.5dbe9a23.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-1d87647f.2e51dd90.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-5ffceace.0ea5174c.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-b2c95ce4.1841b85e.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-5d0cc617.4c893ad3.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-e038f3ae.891ad23e.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-627538dd.7144e0a7.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-220b0cd1.4e281037.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-64802336.ed141770.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-31840cac.b944bdc2.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-b117cf7e.df64c42f.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/1162.d3408974.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/3475.032efde7.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/5883.33434865.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/7937.6102c3bc.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-5c7d04cb.76f847da.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/2307.5ea4c2d9.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/662.cc3b899d.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/1426.b529462f.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/381.efc9c7f6.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/2277.af6d970b.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/4970.7fbd9d88.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-b3ccb192.bb89c06f.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/5137.7bc11b24.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-0440027a.ea9c48bb.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-2b11540d.5346069c.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-1f0489a3.7877dd28.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-7db95cc0.a6ef9657.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-25d83dbe.bc1e6193.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/6321.6178d5b3.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/5421.d43b8b02.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/4839.56e336fd.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/416.643dde4e.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/2922.e6dabe11.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/4607.39e55359.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/1769.79e89645.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/7854.355fb807.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/7255.d3f412ea.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/5734.e922f752.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/6402.ac52c68d.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/9292.16c9429c.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-0c308a02.7a030052.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-4a3d9733.3b589f04.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-b2a9f5e8.327e2006.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/4204.628e56a7.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-6b60e296.9d3b6356.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-b2a9f626.e6bfd6fc.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-8daa1a0e.64603578.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-8b4c6ddc.774f09f7.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-745c8789.62149ac4.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/9944.09d39f9a.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-afc761bc.a3966cba.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/2076.ea11f7bb.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-3706649a.71b76089.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/75.8e0a872d.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/css/8096.styles.d38597ea.css"><link rel="prefetch" href="/learn-wgpu-zh/assets/css/6681.styles.98ee24e7.css">
    <link rel="stylesheet" href="/learn-wgpu-zh/assets/css/styles.dbd69ac3.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/learn-wgpu-zh/" class=""><img class="logo" src="/learn-wgpu-zh/res/wgpu-logo.png" alt="å­¦ä¹  wgpu"><span class="site-name can-hide">å­¦ä¹  wgpu</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">é€‰æ‹©è¯­è¨€</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">é€‰æ‹©è¯­è¨€</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/learn-wgpu-zh/intermediate/tutorial13-terrain/" class="router-link-active router-link-exact-active router-link-active" aria-label="ç®€ä½“ä¸­æ–‡"><!--[--><!--]--> ç®€ä½“ä¸­æ–‡ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://sotrh.github.io/learn-wgpu/" rel="noopener noreferrer" target="_blank" aria-label="English"><!--[--><!--]--> English <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/jinleili/learn-wgpu-zh" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="æœç´¢" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">é€‰æ‹©è¯­è¨€</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">é€‰æ‹©è¯­è¨€</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/learn-wgpu-zh/intermediate/tutorial13-terrain/" class="router-link-active router-link-exact-active router-link-active" aria-label="ç®€ä½“ä¸­æ–‡"><!--[--><!--]--> ç®€ä½“ä¸­æ–‡ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://sotrh.github.io/learn-wgpu/" rel="noopener noreferrer" target="_blank" aria-label="English"><!--[--><!--]--> English <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/jinleili/learn-wgpu-zh" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/learn-wgpu-zh/" class="sidebar-item sidebar-heading" aria-label="ä»‹ç»"><!--[--><!--]--> ä»‹ç» <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading">åŸºç¡€ <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/learn-wgpu-zh/beginner/tutorial1-window/" class="sidebar-item" aria-label="ä¾èµ–ä¸çª—å£"><!--[--><!--]--> ä¾èµ–ä¸çª—å£ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial2-surface/" class="sidebar-item" aria-label="å±•ç¤ºå¹³é¢ (Surface)"><!--[--><!--]--> å±•ç¤ºå¹³é¢ (Surface) <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial3-pipeline/" class="sidebar-item" aria-label="ç®¡çº¿ (Pipeline)"><!--[--><!--]--> ç®¡çº¿ (Pipeline) <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial4-buffer/" class="sidebar-item" aria-label="ç¼“å†²åŒºä¸ç´¢å¼•"><!--[--><!--]--> ç¼“å†²åŒºä¸ç´¢å¼• <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial5-textures/" class="sidebar-item" aria-label="çº¹ç†å’Œç»‘å®šç»„"><!--[--><!--]--> çº¹ç†å’Œç»‘å®šç»„ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial6-uniforms/" class="sidebar-item" aria-label="Uniform ç¼“å†²åŒºä¸ 3D è™šæ‹Ÿæ‘„åƒæœº"><!--[--><!--]--> Uniform ç¼“å†²åŒºä¸ 3D è™šæ‹Ÿæ‘„åƒæœº <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial7-instancing/" class="sidebar-item" aria-label="å®ä¾‹åŒ–ç»˜åˆ¶"><!--[--><!--]--> å®ä¾‹åŒ–ç»˜åˆ¶ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial8-depth/" class="sidebar-item" aria-label="æ·±åº¦ç¼“å†²åŒº"><!--[--><!--]--> æ·±åº¦ç¼“å†²åŒº <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial9-models/" class="sidebar-item" aria-label="æ¨¡å‹åŠ è½½"><!--[--><!--]--> æ¨¡å‹åŠ è½½ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">è¿›é˜¶ <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/learn-wgpu-zh/intermediate/tutorial10-lighting/" class="sidebar-item" aria-label="å…‰ç…§"><!--[--><!--]--> å…‰ç…§ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/intermediate/tutorial11-normals/" class="sidebar-item" aria-label="æ³•çº¿æ˜ å°„"><!--[--><!--]--> æ³•çº¿æ˜ å°„ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/intermediate/tutorial12-camera/" class="sidebar-item" aria-label="æ›´å¥½çš„æ‘„åƒæœº"><!--[--><!--]--> æ›´å¥½çš„æ‘„åƒæœº <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">é›†æˆä¸è°ƒè¯• <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/learn-wgpu-zh/integration-and-debugging/" class="sidebar-item" aria-label="æ¥”å­"><!--[--><!--]--> æ¥”å­ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/integration-and-debugging/ios/" class="sidebar-item" aria-label="ğŸ†• ä¸ iOS App é›†æˆ"><!--[--><!--]--> ğŸ†• ä¸ iOS App é›†æˆ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/integration-and-debugging/android/" class="sidebar-item" aria-label="ğŸ†• ä¸ Android App é›†æˆ"><!--[--><!--]--> ğŸ†• ä¸ Android App é›†æˆ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/integration-and-debugging/xcode/" class="sidebar-item" aria-label="ğŸ†• ä½¿ç”¨ Xcode è°ƒè¯• wgpu ç¨‹åº"><!--[--><!--]--> ğŸ†• ä½¿ç”¨ Xcode è°ƒè¯• wgpu ç¨‹åº <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/integration-and-debugging/snapdragon-profiler/" class="sidebar-item" aria-label="ğŸ†• ä½¿ç”¨ Snapdragon Profiler è°ƒè¯•"><!--[--><!--]--> ğŸ†• ä½¿ç”¨ Snapdragon Profiler è°ƒè¯• <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">æ¡ˆä¾‹å±•ç¤º <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/learn-wgpu-zh/showcase/windowless/" class="sidebar-item" aria-label="ç¦»å±æ¸²æŸ“"><!--[--><!--]--> ç¦»å±æ¸²æŸ“ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/showcase/gifs/" class="sidebar-item" aria-label="ç”Ÿæˆ GIF åŠ¨å›¾"><!--[--><!--]--> ç”Ÿæˆ GIF åŠ¨å›¾ <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/showcase/pong/" class="sidebar-item" aria-label="Pong"><!--[--><!--]--> Pong <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/showcase/compute/" class="sidebar-item" aria-label="Compute Example: Tangents and Bitangents"><!--[--><!--]--> Compute Example: Tangents and Bitangents <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/showcase/alignment/" class="sidebar-item" aria-label="Memory Layout in WGSL"><!--[--><!--]--> Memory Layout in WGSL <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/showcase/imgui-demo/" class="sidebar-item" aria-label="Basic Imgui Demo"><!--[--><!--]--> Basic Imgui Demo <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/learn-wgpu-zh/GLOSSARY_OF_TERMS.html" class="sidebar-item sidebar-heading" aria-label="æœ¯è¯­ä¸­è‹±å¯¹ç…§è¡¨"><!--[--><!--]--> æœ¯è¯­ä¸­è‹±å¯¹ç…§è¡¨ <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="ç¨‹åºåœ°å½¢" tabindex="-1"><a class="header-anchor" href="#ç¨‹åºåœ°å½¢" aria-hidden="true">#</a> ç¨‹åºåœ°å½¢</h1><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ä¸€ä¸ªç©ºæ—·çš„åœºæ™¯é‡Œæ¸²æŸ“æ¨¡å‹ã€‚å¦‚æœåªæ˜¯æƒ³æµ‹è¯•ç€è‰²ä»£ç ï¼Œè¿™æ˜¯éå¸¸å¥½çš„ï¼Œä½†å¤§å¤šæ•°åº”ç”¨ç¨‹åºä¼šæƒ³è®©å±å¹•ä¸Šå¡«å……æ›´å¤šæœ‰è¶£çš„å…ƒç´ ã€‚ ä½ å¯ä»¥ç”¨å„ç§æ–¹æ³•æ¥å¤„ç†æ­¤é—®é¢˜ï¼Œæ¯”å¦‚ï¼Œåœ¨ Blender ä¸­åˆ›å»ºä¸€å †æ¨¡å‹ï¼Œç„¶åæŠŠå®ƒä»¬åŠ è½½åˆ°åœºæ™¯ä¸­ã€‚å¦‚æœä½ æœ‰ä¸€äº›åƒæ ·çš„è‰ºæœ¯æŠ€å·§å’Œä¸€äº›è€å¿ƒï¼Œè¿™æ˜¯å¾ˆæœ‰æ•ˆçš„æ–¹æ³•ã€‚æˆ‘åœ¨è¿™ä¸¤ä¸ªæ–¹é¢éƒ½å¾ˆæ¬ ç¼ºï¼Œæ‰€ä»¥è®©æˆ‘ä»¬é€šè¿‡ä»£ç æ¥åˆ¶ä½œä¸€äº›çœ‹èµ·æ¥ä¸é”™çš„ä¸œè¥¿ã€‚</p><p>æ­£å¦‚æœ¬æ–‡çš„åå­—æ‰€ç¤ºï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª<strong>åœ°å½¢</strong>ï¼ˆTerrainï¼‰ã€‚ç°åœ¨ï¼Œåˆ›å»ºåœ°å½¢ç½‘æ ¼çš„ç»å…¸æ–¹æ³•æ˜¯ä½¿ç”¨é¢„å…ˆç”Ÿæˆçš„<strong>å™ªå£°çº¹ç†</strong>ï¼ˆNoise Textureï¼‰ï¼Œå¹¶å¯¹å…¶è¿›è¡Œé‡‡æ ·ï¼Œä»¥è·å¾—ç½‘æ ¼ä¸­æ¯ä¸ªç‚¹çš„é«˜åº¦å€¼ã€‚è¿™æ˜¯ä¸€ä¸ªç›¸å½“æœ‰æ•ˆçš„æ–¹æ³•ï¼Œä½†æˆ‘é€‰æ‹©äº†ç›´æ¥ä½¿ç”¨è®¡ç®—ç€è‰²å™¨æ¥ç”Ÿæˆå™ªå£°ã€‚è®©æˆ‘ä»¬å¼€å§‹å§!</p><h2 id="è®¡ç®—ç€è‰²å™¨" tabindex="-1"><a class="header-anchor" href="#è®¡ç®—ç€è‰²å™¨" aria-hidden="true">#</a> è®¡ç®—ç€è‰²å™¨</h2><p><strong>è®¡ç®—ç€è‰²å™¨</strong>ï¼ˆCompute Shaderï¼‰å…è®¸ä½ åˆ©ç”¨ GPU çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›å®Œæˆä»»æ„ä»»åŠ¡ã€‚è™½ç„¶å®ƒä¹Ÿå¯ä»¥ç”¨äºæ¸²æŸ“ä»»åŠ¡ï¼Œä½†é€šå¸¸ç”¨äºä¸ç»˜åˆ¶ä¸‰è§’å½¢å’Œåƒç´ æ²¡æœ‰ç›´æ¥å…³ç³»çš„ä»»åŠ¡ï¼Œæ¯”å¦‚ï¼Œç‰©ç†æ¨¡æ‹Ÿã€å›¾åƒæ»¤é•œã€åˆ›å»ºç¨‹åºçº¹ç†ã€è¿è¡Œç¥ç»ç½‘ç»œç­‰ç­‰ã€‚æˆ‘ç¨åä¼šè¯¦ç»†ä»‹ç»å®ƒä»¬çš„å·¥ä½œåŸç†ï¼Œä½†ç°åœ¨åªéœ€ç”¨å®ƒä»¬æ¥ä¸ºæˆ‘ä»¬çš„åœ°å½¢åˆ›å»ºé¡¶ç‚¹å’Œç´¢å¼•ç¼“å†²åŒºã€‚</p><h2 id="å™ªå£°å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#å™ªå£°å‡½æ•°" aria-hidden="true">#</a> å™ªå£°å‡½æ•°</h2><p>è®©æˆ‘ä»¬ä»è®¡ç®—ç€è‰²å™¨çš„ä»£ç å¼€å§‹ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º <code>terrain.wgsl</code> çš„æ–°æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶å†…å…ˆå®ç°ä¸€ä¸ª<strong>å™ªå£°å‡½æ•°</strong>ï¼ˆNoise Functionï¼‰ï¼Œç„¶åå†åˆ›å»ºç€è‰²å™¨çš„å…¥å£å‡½æ•°ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token comment">// ============================</span>
<span class="token comment">// åœ°å½¢ç”Ÿæˆ</span>
<span class="token comment">// ============================</span>

<span class="token comment">// https://gist.github.com/munrocket/236ed5ba7e409b8bdf1ff6eca5dcdc39</span>
<span class="token comment">//  MIT License. Â© Ian McEwan, Stefan Gustavson, Munrocket</span>
<span class="token comment">// - Less condensed glsl implementation with comments can be found at https://weber.itn.liu.se/~stegu/jgt2012/article.pdf</span>

<span class="token keyword">fn</span> <span class="token functions function">permute3</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">*</span> <span class="token decimal-float-literal number">34.</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token decimal-float-literal number">1.</span><span class="token punctuation">)</span> <span class="token operator">*</span> x<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span><span class="token decimal-float-literal number">289.</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token functions function">snoise2</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token builtin">f32</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token class-name">C</span> <span class="token operator">=</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span><span class="token decimal-float-literal number">0.211324865405187</span><span class="token punctuation">,</span> <span class="token decimal-float-literal number">0.366025403784439</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token decimal-float-literal number">0.577350269189626</span><span class="token punctuation">,</span> <span class="token decimal-float-literal number">0.024390243902439</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> i<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span> <span class="token operator">=</span> <span class="token builtin">floor</span><span class="token punctuation">(</span>v <span class="token operator">+</span> <span class="token builtin">dot</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token class-name">C</span><span class="token punctuation">.</span>yy<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> x0 <span class="token operator">=</span> v <span class="token operator">-</span> i <span class="token operator">+</span> <span class="token builtin">dot</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token class-name">C</span><span class="token punctuation">.</span>xx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// I flipped the condition here from &gt; to &lt; as it fixed some artifacting I was observing</span>
  <span class="token keyword">var</span> i1<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span> <span class="token operator">=</span> <span class="token builtin">select</span><span class="token punctuation">(</span><span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span><span class="token decimal-float-literal number">1.</span><span class="token punctuation">,</span> <span class="token decimal-float-literal number">0.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span><span class="token decimal-float-literal number">0.</span><span class="token punctuation">,</span> <span class="token decimal-float-literal number">1.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token decimal-float-literal number">0.</span>x <span class="token punctuation">&lt;</span> x<span class="token decimal-float-literal number">0.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> x12<span class="token punctuation">:</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span> <span class="token operator">=</span> x<span class="token decimal-float-literal number">0.</span>xyxy <span class="token operator">+</span> <span class="token class-name">C</span><span class="token punctuation">.</span>xxzz <span class="token operator">-</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span>i1<span class="token punctuation">,</span> <span class="token decimal-float-literal number">0.</span><span class="token punctuation">,</span> <span class="token decimal-float-literal number">0.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  i <span class="token operator">=</span> i <span class="token operator">%</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span><span class="token decimal-float-literal number">289.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token function-calls function">permute3</span><span class="token punctuation">(</span><span class="token function-calls function">permute3</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span><span class="token decimal-float-literal number">0.</span><span class="token punctuation">,</span> i<span class="token decimal-float-literal number">1.</span>y<span class="token punctuation">,</span> <span class="token decimal-float-literal number">1.</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> i<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span><span class="token decimal-float-literal number">0.</span><span class="token punctuation">,</span> i<span class="token decimal-float-literal number">1.</span>x<span class="token punctuation">,</span> <span class="token decimal-float-literal number">1.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> m<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span> <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token decimal-float-literal number">0.5</span> <span class="token operator">-</span>
      <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span><span class="token builtin">dot</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> x0<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">dot</span><span class="token punctuation">(</span>x<span class="token decimal-float-literal number">12.</span>xy<span class="token punctuation">,</span> x<span class="token decimal-float-literal number">12.</span>xy<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">dot</span><span class="token punctuation">(</span>x<span class="token decimal-float-literal number">12.</span>zw<span class="token punctuation">,</span> x<span class="token decimal-float-literal number">12.</span>zw<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span><span class="token decimal-float-literal number">0.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  m <span class="token operator">=</span> m <span class="token operator">*</span> m<span class="token punctuation">;</span>
  m <span class="token operator">=</span> m <span class="token operator">*</span> m<span class="token punctuation">;</span>
  <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token decimal-float-literal number">2.</span> <span class="token operator">*</span> <span class="token builtin">fract</span><span class="token punctuation">(</span>p <span class="token operator">*</span> <span class="token class-name">C</span><span class="token punctuation">.</span>www<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token decimal-float-literal number">1.</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> h <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token decimal-float-literal number">0.5</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> ox <span class="token operator">=</span> <span class="token builtin">floor</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token decimal-float-literal number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> a0 <span class="token operator">=</span> x <span class="token operator">-</span> ox<span class="token punctuation">;</span>
  m <span class="token operator">=</span> m <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token decimal-float-literal number">1.79284291400159</span> <span class="token operator">-</span> <span class="token decimal-float-literal number">0.85373472095314</span> <span class="token operator">*</span> <span class="token punctuation">(</span>a0 <span class="token operator">*</span> a0 <span class="token operator">+</span> h <span class="token operator">*</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> g <span class="token operator">=</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span>a<span class="token decimal-float-literal number">0.</span>x <span class="token operator">*</span> x<span class="token decimal-float-literal number">0.</span>x <span class="token operator">+</span> h<span class="token punctuation">.</span>x <span class="token operator">*</span> x<span class="token decimal-float-literal number">0.</span>y<span class="token punctuation">,</span> a<span class="token decimal-float-literal number">0.</span>yz <span class="token operator">*</span> x<span class="token decimal-float-literal number">12.</span>xz <span class="token operator">+</span> h<span class="token punctuation">.</span>yz <span class="token operator">*</span> x<span class="token decimal-float-literal number">12.</span>yw<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token decimal-float-literal number">130.</span> <span class="token operator">*</span> <span class="token builtin">dot</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> g<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éƒ¨åˆ†è¯»è€…å¯èƒ½å·²ç»è®¤å‡ºè¿™æ˜¯ Simplex å™ªå£°ï¼ˆç‰¹åˆ«æ˜¯ OpenSimplex å™ªå£°ï¼‰çš„ä¸€ä¸ªå®ç°ã€‚æˆ‘æ‰¿è®¤æ²¡æœ‰çœŸæ­£ç†è§£ OpenSimplex å™ªå£°èƒŒåçš„æ•°å­¦åŸç†ã€‚å®ƒçš„åŸºæœ¬åŸç†ç±»ä¼¼äº Perlin å™ªå£°ï¼Œä½†ä¸æ˜¯ä¸€ä¸ªæ­£æ–¹å½¢ç½‘æ ¼ï¼Œè€Œæ˜¯å…­è¾¹å½¢ç½‘æ ¼ï¼Œè¿™æ¶ˆé™¤äº†åœ¨æ­£æ–¹å½¢ç½‘æ ¼ä¸Šäº§ç”Ÿå™ªå£°çš„ä¸€äº›ä¼ªå½±ã€‚æˆ‘ä¹Ÿä¸æ˜¯è¿™æ–¹é¢çš„ä¸“å®¶ï¼Œæ‰€ä»¥æ€»ç»“ä¸€ä¸‹ï¼š<code>permute3()</code> æ¥æ”¶ä¸€ä¸ª <code>vec3</code> å¹¶è¿”å›ä¸€ä¸ªä¼ªéšæœºçš„ <code>vec3</code>ï¼Œ<code>snoise2()</code> æ¥æ”¶ä¸€ä¸ª <code>vec2</code> å¹¶è¿”å›ä¸€ä¸ª [-1, 1] ä¹‹é—´çš„æµ®ç‚¹æ•°ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºå™ªå£°å‡½æ•°çš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹<a href="https://thebookofshaders.com/11/" target="_blank" rel="noopener noreferrer">è¿™ç¯‡æ–‡ç« æ¥è‡ª The Book of Shaders<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚ä»£ç æ˜¯ç”¨ GLSL ç¼–å†™çš„ï¼Œä½†æ¦‚å¿µæ˜¯ä¸€æ ·çš„ã€‚</p><p>ä»ä¸‹é¢çš„æ¸²æŸ“ç»“æœå¯ä»¥çœ‹å‡ºï¼Œç›´æ¥ä½¿ç”¨ <code>snoise</code> çš„è¾“å‡ºæ¥ç”Ÿæˆåœ°å½¢çš„é«˜åº¦å€¼ï¼Œåœ°è¡¨å¾€å¾€è¿‡äºå¹³æ»‘ã€‚è™½ç„¶è¿™å¯èƒ½å°±æ˜¯ä½ æƒ³è¦çš„ï¼Œä½†å®ƒçœ‹èµ·æ¥ä¸åƒæ˜¯è‡ªç„¶ç•Œçš„åœ°å½¢ã€‚</p><p><img src="/learn-wgpu-zh/assets/img/figure_no-fbm.4b1e6659.png" alt="smooth terrain"></p><p>ä¸ºäº†ä½¿åœ°å½¢æ›´åŠ ç²—ç³™ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ç§å«åš<a href="https://thebookofshaders.com/13/" target="_blank" rel="noopener noreferrer">åˆ†å½¢å¸ƒæœ—è¿åŠ¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>çš„æŠ€æœ¯ã€‚è¿™ç§æŠ€æœ¯çš„å·¥ä½œåŸç†æ˜¯å¯¹å™ªå£°å‡½æ•°è¿›è¡Œå¤šæ¬¡é‡‡æ ·ï¼Œæ¯æ¬¡å°†å¼ºåº¦å‡åŠï¼ŒåŒæ—¶å°†å™ªå£°çš„é¢‘ç‡æé«˜ä¸€å€ã€‚ è¿™æ„å‘³ç€åœ°å½¢çš„æ•´ä½“å½¢çŠ¶ä¿æŒå¹³æ»‘ï¼ŒåŒæ—¶æ‹¥æœ‰æ›´æ¸…æ™°çš„ç»†èŠ‚ï¼Œå¾—åˆ°çš„æ•ˆæœå°†æ˜¯ä¸‹é¢è¿™æ ·:</p><p><img src="/learn-wgpu-zh/assets/img/figure_fbm.24224480.png" alt="more organic terrain"></p><p>è¿™ä¸ªå‡½æ•°çš„ä»£ç å…¶å®å¾ˆç®€å•ï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token keyword">fn</span> <span class="token functions function">fbm</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token builtin">f32</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> NUM_OCTAVES<span class="token punctuation">:</span> <span class="token builtin">u32</span> <span class="token operator">=</span> <span class="token int-literal number">5u</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> p <span class="token operator">*</span> <span class="token decimal-float-literal number">0.01</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> v <span class="token operator">=</span> <span class="token decimal-float-literal number">0.0</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token decimal-float-literal number">0.5</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> shift <span class="token operator">=</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span><span class="token decimal-float-literal number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> cs <span class="token operator">=</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span><span class="token builtin">cos</span><span class="token punctuation">(</span><span class="token decimal-float-literal number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">sin</span><span class="token punctuation">(</span><span class="token decimal-float-literal number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> rot <span class="token operator">=</span> <span class="token builtin">mat2x2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span>cs<span class="token punctuation">.</span>x<span class="token punctuation">,</span> cs<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token operator">-</span>cs<span class="token punctuation">.</span>y<span class="token punctuation">,</span> cs<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token int-literal number">0u</span><span class="token punctuation">;</span> i<span class="token punctuation">&lt;</span>NUM_OCTAVES<span class="token punctuation">;</span> i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token int-literal number">1u</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        v <span class="token operator">=</span> v <span class="token operator">+</span> a <span class="token operator">*</span> <span class="token function-calls function">snoise2</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        x <span class="token operator">=</span> rot <span class="token operator">*</span> x <span class="token operator">*</span> <span class="token decimal-float-literal number">2.0</span> <span class="token operator">+</span> shift<span class="token punctuation">;</span>
        a <span class="token operator">=</span> a <span class="token operator">*</span> <span class="token decimal-float-literal number">0.5</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> v<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è®©æˆ‘ä»¬ç¨å¾®å›é¡¾ä¸€ä¸‹ï¼š</p><ul><li><code>NUM_OCTAVES</code> å¸¸æ•°è®¾å®šå™ªå£°çº§åˆ«ã€‚æ›´é«˜çš„çº§åˆ«å°†ç»™åœ°å½¢ç½‘æ ¼å¢åŠ æ›´å¤šçš„ç»†èŠ‚ï¼Œä½†çº§åˆ«è¶Šé«˜ï¼Œå¾—åˆ°çš„å›æŠ¥å°†é€’å‡ï¼Œæˆ‘å‘ç° 5 æ˜¯ä¸€ä¸ªå¥½æ•°å­—ã€‚</li><li><code>p</code> ä¹˜ä»¥ <code>0.01</code> ç”¨æ¥â€œæ”¾å¤§â€å™ªå£°å‡½æ•°ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬çš„ç½‘æ ¼å°†æ˜¯ 1x1 çš„å››è¾¹å½¢ï¼Œè€Œ simplex å™ªå£°å‡½æ•°åœ¨æ¯æ­¥è¿›ä¸€æ¬¡æ—¶ç±»ä¼¼äºç™½å™ªå£°ã€‚æˆ‘ä»¬æ¥çœ‹åˆ°ç›´æ¥ä½¿ç”¨ <code>p</code> æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼š<img src="/learn-wgpu-zh/assets/img/figure_spiky.97a28c73.png" alt="spiky terrain"></li><li><code>a</code> å˜é‡æ˜¯åœ¨ç»™å®šçš„å™ªå£°çº§åˆ«ä¸‹çš„å™ªå£°æŒ¯å¹…ã€‚</li><li><code>shift</code> å’Œ <code>rot</code> ç”¨äºå‡å°‘ç”Ÿæˆçš„å™ªå£°ä¸­çš„å¤±çœŸã€‚å…¶ä¸­ä¸€ä¸ªå¤±çœŸç°è±¡æ˜¯ï¼Œåœ¨ <code>0,0</code> å¤„ï¼Œæ— è®ºä½ å¦‚ä½•ç¼©æ”¾ <code>p</code>ï¼Œ<code>snoise</code> çš„è¾“å‡ºéƒ½æ˜¯ä¸€æ ·çš„ã€‚</li></ul><h2 id="ç”Ÿæˆç½‘æ ¼" tabindex="-1"><a class="header-anchor" href="#ç”Ÿæˆç½‘æ ¼" aria-hidden="true">#</a> ç”Ÿæˆç½‘æ ¼</h2><p>ä¸ºäº†ç”Ÿæˆåœ°å½¢ç½‘æ ¼ï¼Œéœ€è¦å‘ç€è‰²å™¨ä¼ é€’ä¸€äº›ä¿¡æ¯ï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token keyword">struct</span> <span class="token class-name">ChunkData</span> <span class="token punctuation">{</span>
    chunk_size<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">u32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    chunk_corner<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">i32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    min_max_height<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token class-name">Vertex</span> <span class="token punctuation">{</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> position<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">1</span><span class="token punctuation">)</span> normal<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token class-name">VertexBuffer</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token builtin">array</span><span class="token punctuation">&lt;</span><span class="token class-name">Vertex</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token comment">// stride: 32</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token class-name">IndexBuffer</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token builtin">array</span><span class="token punctuation">&lt;</span><span class="token builtin">u32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token punctuation">@</span><span class="token attributes attr-name">group</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> <span class="token punctuation">@</span><span class="token attributes attr-name">binding</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> <span class="token keyword">var</span><span class="token punctuation">&lt;</span><span class="token keyword">uniform</span><span class="token punctuation">&gt;</span> chunk_data<span class="token punctuation">:</span> <span class="token class-name">ChunkData</span><span class="token punctuation">;</span>
<span class="token punctuation">@</span><span class="token attributes attr-name">group</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span><span class="token punctuation">@</span><span class="token attributes attr-name">binding</span><span class="token punctuation">(</span><span class="token int-literal number">1</span><span class="token punctuation">)</span> <span class="token keyword">var</span><span class="token punctuation">&lt;</span><span class="token keyword">storage</span><span class="token punctuation">,</span> read_write<span class="token punctuation">&gt;</span> vertices<span class="token punctuation">:</span> <span class="token class-name">VertexBuffer</span><span class="token punctuation">;</span>
<span class="token punctuation">@</span><span class="token attributes attr-name">group</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span><span class="token punctuation">@</span><span class="token attributes attr-name">binding</span><span class="token punctuation">(</span><span class="token int-literal number">2</span><span class="token punctuation">)</span> <span class="token keyword">var</span><span class="token punctuation">&lt;</span><span class="token keyword">storage</span><span class="token punctuation">,</span> read_write<span class="token punctuation">&gt;</span> indices<span class="token punctuation">:</span> <span class="token class-name">IndexBuffer</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬ä¼ é€’ç»™è‰²å™¨çš„ <code>uniform</code> ç¼“å†²åŒºï¼Œå…¶ä¸­åŒ…æ‹¬å››è¾¹å½¢ç½‘æ ¼çš„å¤§å° <code>chunk_size</code>ï¼Œå™ªå£°ç®—æ³•çš„èµ·å§‹ç‚¹ <code>chunk_corner</code> ï¼Œä»¥åŠåœ°å½¢çš„ <code>min_max_height</code>ã€‚</p><p>é¡¶ç‚¹å’Œç´¢å¼•ç¼“å†²åŒºä½œä¸º <code>storage</code> ç¼“å†²åŒºä¼ å…¥ï¼Œå¹¶å¯ç”¨ <code>read_write</code> è®¿é—®æ¨¡å¼æ¥æ”¯æŒæ•°æ®çš„è¯»å–ä¸å†™å…¥ã€‚æˆ‘ä»¬å°†åœ¨ Rust ä¸­åˆ›å»ºè¿™äº›ç¼“å†²åŒºï¼Œå¹¶åœ¨æ‰§è¡Œè®¡ç®—ç€è‰²å™¨æ—¶å°†å…¶ç»‘å®šã€‚</p><p>ç€è‰²å™¨çš„ä¸‹ä¸€ä¸ªéƒ¨åˆ†æ˜¯åœ¨ç½‘æ ¼ä¸Šç”Ÿæˆä¸€ä¸ªç‚¹ï¼Œä»¥åŠè¯¥ç‚¹çš„ä¸€ä¸ªé¡¶ç‚¹ï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token keyword">fn</span> <span class="token functions function">terrain_point</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span>
        p<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
        <span class="token builtin">mix</span><span class="token punctuation">(</span>chunk_data<span class="token punctuation">.</span>min_max_height<span class="token punctuation">.</span>x<span class="token punctuation">,</span>chunk_data<span class="token punctuation">.</span>min_max_height<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token function-calls function">fbm</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        p<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token functions function">terrain_vertex</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Vertex</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function-calls function">terrain_point</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> tpx <span class="token operator">=</span> <span class="token function-calls function">terrain_point</span><span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span><span class="token decimal-float-literal number">0.1</span><span class="token punctuation">,</span> <span class="token decimal-float-literal number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> v<span class="token punctuation">;</span>
    <span class="token keyword">let</span> tpz <span class="token operator">=</span> <span class="token function-calls function">terrain_point</span><span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span><span class="token decimal-float-literal number">0.0</span><span class="token punctuation">,</span> <span class="token decimal-float-literal number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> v<span class="token punctuation">;</span>
    <span class="token keyword">let</span> tnx <span class="token operator">=</span> <span class="token function-calls function">terrain_point</span><span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token decimal-float-literal number">0.1</span><span class="token punctuation">,</span> <span class="token decimal-float-literal number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> v<span class="token punctuation">;</span>
    <span class="token keyword">let</span> tnz <span class="token operator">=</span> <span class="token function-calls function">terrain_point</span><span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span><span class="token decimal-float-literal number">0.0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token decimal-float-literal number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> v<span class="token punctuation">;</span>

    <span class="token keyword">let</span> pn <span class="token operator">=</span> <span class="token builtin">normalize</span><span class="token punctuation">(</span><span class="token builtin">cross</span><span class="token punctuation">(</span>tpz<span class="token punctuation">,</span> tpx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> nn <span class="token operator">=</span> <span class="token builtin">normalize</span><span class="token punctuation">(</span><span class="token builtin">cross</span><span class="token punctuation">(</span>tnz<span class="token punctuation">,</span> tnx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token punctuation">(</span>pn <span class="token operator">+</span> nn<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token decimal-float-literal number">0.5</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function-calls function">Vertex</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>terrain_point</code> å‡½æ•°æ¥æ”¶åœ°å½¢ä¸Šçš„ä¸€ä¸ª XZ ç‚¹ï¼Œå¹¶è¿”å›ä¸€ä¸ª <code>vec3</code>ï¼Œå…¶ä¸­ <code>y</code> å€¼åœ¨æœ€å°å’Œæœ€å¤§é«˜åº¦ä¹‹é—´ã€‚</p><p><code>terrain_vertex</code> ä½¿ç”¨ <code>terrain_point</code> æ¥è·å¾—å®ƒçš„ä½ç½®ï¼ŒåŒæ—¶é€šè¿‡å¯¹é™„è¿‘çš„ 4 ä¸ªç‚¹è¿›è¡Œé‡‡æ ·ï¼Œå¹¶ä½¿ç”¨<a href="https://www.khanacademy.org/math/multivariable-calculus/thinking-about-multivariable-function/x786f2022:vectors-and-matrices/a/cross-products-mvc" target="_blank" rel="noopener noreferrer">å‰ç§¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ¥è®¡ç®—é¡¶ç‚¹æ³•çº¿ã€‚</p><div class="note"><p>ä½ åº”è¯¥æ³¨æ„åˆ°äº† <code>Vertex</code> ç»“æ„ä½“ä¸åŒ…æ‹¬çº¹ç†åæ ‡å­—æ®µã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨é¡¶ç‚¹çš„ XZ åæ ‡ï¼Œå¹¶è®©çº¹ç†é‡‡æ ·å™¨åœ¨ X å’Œ Y è½´ä¸Šé•œåƒçº¹ç†æ¥è½»æ¾åœ°åˆ›å»ºçº¹ç†åæ ‡ï¼Œä½†ä»¥è¿™ç§æ–¹å¼è¿›è¡Œçº¹ç†é‡‡æ ·æ—¶ï¼Œé«˜åº¦å›¾å¾€å¾€ä¼šæœ‰æ‹‰ä¼¸ç°è±¡ã€‚</p><p>æˆ‘ä»¬å°†åœ¨æœªæ¥çš„æ•™ç¨‹ä¸­ä»‹ç»ä¸€ç§å«åšä¸‰å¹³é¢æ˜ å°„çš„æ–¹æ³•æ¥ç»™åœ°å½¢è´´å›¾ã€‚ä½†ç°åœ¨æˆ‘ä»¬åªä½¿ç”¨ä¸€ä¸ªç¨‹åºçº¹ç†ï¼Œå®ƒå°†åœ¨æ¸²æŸ“åœ°å½¢çš„ç‰‡å…ƒç€è‰²å™¨ä¸­è¢«åˆ›å»ºã€‚</p></div><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨åœ°å½¢è¡¨é¢è·å¾—ä¸€ä¸ªå®é™…çš„é¡¶ç‚¹æ•°æ®ï¼Œå¹¶ç”¨æ¥å¡«å……é¡¶ç‚¹å’Œç´¢å¼•ç¼“å†²åŒºäº†ã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª <code>gen_terrain()</code> å‡½æ•°ä½œä¸ºè®¡ç®—ç€è‰²å™¨çš„å…¥å£ï¼š</p><div class="language-wgsl ext-wgsl line-numbers-mode"><pre class="language-wgsl"><code><span class="token punctuation">@</span><span class="token attributes attr-name">compute</span> <span class="token punctuation">@</span><span class="token attributes attr-name">workgroup_size</span><span class="token punctuation">(</span><span class="token int-literal number">64</span><span class="token punctuation">)</span>
<span class="token keyword">fn</span> <span class="token functions function">gen_terrain</span><span class="token punctuation">(</span>
    <span class="token punctuation">@</span><span class="token builtin-attribute"><span class="token attribute attr-name">builtin</span><span class="token punctuation">(</span><span class="token built-in-values attr-value">global_invocation_id</span><span class="token punctuation">)</span></span> gid<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">u32</span><span class="token punctuation">&gt;</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// snipped...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>@stage(compute)</code> æ³¨é‡ŠæŒ‡å®šäº† <code>gen_terrain</code> æ˜¯ä¸€ä¸ªè®¡ç®—ç€è‰²å™¨å…¥å£ã€‚</p><p><a href="https://www.w3.org/TR/WGSL/#attribute-workgroup_size" target="_blank" rel="noopener noreferrer"><code>workgroup_size()</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æŒ‡å®š GPU å¯ä»¥ä¸ºæ¯ä¸ª<strong>å·¥ä½œç»„</strong>ï¼ˆworkgroupï¼‰åˆ†é…çš„ä¸€ç»„è°ƒç”¨ï¼Œè¿™ä¸€ç»„è°ƒç”¨ä¼šåŒæ—¶æ‰§è¡Œç€è‰²å™¨å…¥å£å‡½æ•°ï¼Œå¹¶å…±äº«å¯¹å·¥ä½œç»„åœ°å€ç©ºé—´ä¸­ç€è‰²å™¨å˜é‡çš„è®¿é—®ã€‚ æˆ‘ä»¬åœ¨ç¼–å†™è®¡ç®—ç€è‰²å™¨çš„æ—¶å€™æŒ‡å®šå·¥ä½œç»„çš„å¤§å°ï¼Œå®ƒæœ‰ 3 ä¸ªç»´åº¦çš„å‚æ•°ï¼Œå› ä¸ºå·¥ä½œç»„æ˜¯ä¸€ä¸ª 3D ç½‘æ ¼ï¼Œä½†å¦‚æœä¸æŒ‡å®šå®ƒä»¬ï¼Œåˆ™é»˜è®¤ä¸º 1ã€‚ æ¢å¥è¯è¯´ï¼Œ<code>workgroup_size(64)</code> ç›¸å½“äº <code>workgroup_size(64, 1, 1)</code>ã€‚</p><p><code>global_invocation_id</code> æ˜¯ä¸€ä¸ª 3D ç´¢å¼•ã€‚è¿™å¯èƒ½çœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼Œä½†ä½ å¯ä»¥æŠŠå·¥ä½œç»„çœ‹ä½œæ˜¯å·¥ä½œç»„çš„ 3D ç½‘æ ¼ã€‚è¿™äº›å·¥ä½œç»„æœ‰ä¸€ä¸ªå†…éƒ¨çš„å·¥ä½œè€…ç½‘æ ¼ã€‚<code>global_invocation_id</code> å°±æ˜¯ç›¸å¯¹äºæ‰€æœ‰å…¶ä»–å·¥ä½œç»„çš„å½“å‰å·¥ä½œè€…çš„ idã€‚</p><p>ä»è§†è§‰ä¸Šçœ‹ï¼Œå·¥ä½œç»„çš„ç½‘æ ¼çœ‹èµ·æ¥ä¼šæ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/learn-wgpu-zh/assets/img/figure_work-groups.278667c2.jpg" alt="work group grid"></p><div class="note"><p>æŠŠè®¡ç®—ç€è‰²å™¨æƒ³è±¡æˆä¸€ä¸ªåœ¨ä¸€å †åµŒå¥—çš„ for å¾ªç¯ä¸­è¿è¡Œçš„å‡½æ•°ï¼Œä½†æ¯ä¸ªå¾ªç¯éƒ½æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œè¿™å¯èƒ½ä¼šæœ‰å¸®åŠ©ã€‚å®ƒçœ‹èµ·æ¥ä¼šåƒè¿™æ ·ï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>for wgx in num_workgroups.x:
    for wgy in num_workgroups.y:
        for wgz in num_workgroups.z:
            var local_invocation_id = (wgx, wgy, wgz)
            for x in workgroup_size.x:
                for y in workgroup_size.x:
                    for z in workgroup_size.x:
                        var global_invocation_id = local_invocation_id * workgroup_size + (x, y, z);
                        gen_terrain(global_invocation_id)

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæƒ³äº†è§£æ›´å¤šå…³äºå·¥ä½œç»„çš„ä¿¡æ¯<a href="https://www.w3.org/TR/WGSL/#compute-shader-workgroups" target="_blank" rel="noopener noreferrer">è¯·æŸ¥çœ‹ WGSL æ–‡æ¡£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p></div><p>TODO:</p><ul><li>Note changes to <code>create_render_pipeline</code></li><li>Mention <code>swizzle</code> feature for cgmath</li><li>Compare workgroups and workgroups sizes to nested for loops <ul><li>Maybe make a diagram in blender?</li></ul></li><li>Change to camera movement speed</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">ä¸Šæ¬¡æ›´æ–°: </span><!----></div><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/learn-wgpu-zh/assets/js/runtime~app.1fe6cd89.js" defer></script><script src="/learn-wgpu-zh/assets/js/3866.84df6019.js" defer></script><script src="/learn-wgpu-zh/assets/js/app.986ad84b.js" defer></script>
  </body>
</html>
