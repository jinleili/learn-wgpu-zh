<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Pong | 学习 wgpu</title><meta name="description" content="使用 Rust 学习 wgpu">
    <link rel="preload" href="/learn-wgpu-zh/assets/js/runtime~app.da394f90.js" as="script"><link rel="preload" href="/learn-wgpu-zh/assets/css/styles.f5314d33.css" as="style"><link rel="preload" href="/learn-wgpu-zh/assets/js/9141.74699445.js" as="script"><link rel="preload" href="/learn-wgpu-zh/assets/js/app.7a8054bf.js" as="script"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-2d69bb60.4ad7e3d5.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-bfc81dd6.7610dd06.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-4249d10f.c8f08817.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-82a25e06.36227ce7.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-2168b6f4.082f69c8.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-1d87647f.7013bab7.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-5ffceace.798009a5.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-b2c95ce4.cd4e566f.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-5d0cc617.32ce7bdf.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-627538dd.522e9dbf.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-220b0cd1.77e47817.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-64802336.4bd624e8.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-31840cac.52f72f62.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-b117cf7e.f771a00f.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/1162.2ea6707c.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/3475.a809e012.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/5883.5147f7d5.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/7937.ce4c90cb.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/1426.87fee456.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/2307.a4b1569f.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/381.14108687.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/662.1adc6c1b.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-b3ccb192.66c258ab.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/2277.bf1af19b.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/4970.5aae0d9f.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/5137.72720074.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-0440027a.2a7be179.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-2b11540d.ce61c40a.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-1f0489a3.40efb4d9.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-7db95cc0.8067cf73.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-25d83dbe.21b8ce4e.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/6321.2154bf48.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/5421.ea0a9875.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/4839.38de57f2.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/416.263c3017.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/2922.07ac6f22.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/4607.4c710cc5.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/1769.a6f87e60.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/7854.4bf820b5.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/7255.ec42f8b1.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/5734.0dce093b.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/6402.6d66210a.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/9292.fb0e80aa.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-b2a9f5e8.70cbf4c7.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/4204.63b46fe4.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-6b60e296.6e133223.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-b2a9f626.1e209a62.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-8daa1a0e.254e2e03.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-8b4c6ddc.9dddfbb2.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/9944.efbaf280.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-afc761bc.82f0088e.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/2076.158ecac5.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/v-3706649a.a69da219.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/js/75.ccb1e0c7.js"><link rel="prefetch" href="/learn-wgpu-zh/assets/css/9253.styles.173ab900.css"><link rel="prefetch" href="/learn-wgpu-zh/assets/css/1610.styles.a289f906.css">
    <link rel="stylesheet" href="/learn-wgpu-zh/assets/css/styles.f5314d33.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/learn-wgpu-zh/" class=""><!----><span class="site-name">学习 wgpu</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">选择语言</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">选择语言</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/learn-wgpu-zh/showcase/pong/" class="router-link-active router-link-exact-active router-link-active" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://sotrh.github.io/learn-wgpu/" rel="noopener noreferrer" target="_blank" aria-label="English"><!--[--><!--]--> English <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/jinleili/learn-wgpu-zh" rel="noopener noreferrer" target="_blank" aria-label="《Learn wgpu》中文版"><!--[--><!--]--> 《Learn wgpu》中文版 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">选择语言</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">选择语言</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a aria-current="page" href="/learn-wgpu-zh/showcase/pong/" class="router-link-active router-link-exact-active router-link-active" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://sotrh.github.io/learn-wgpu/" rel="noopener noreferrer" target="_blank" aria-label="English"><!--[--><!--]--> English <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/jinleili/learn-wgpu-zh" rel="noopener noreferrer" target="_blank" aria-label="《Learn wgpu》中文版"><!--[--><!--]--> 《Learn wgpu》中文版 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/learn-wgpu-zh/" class="sidebar-item sidebar-heading" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading">基础 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/learn-wgpu-zh/beginner/tutorial1-window/" class="sidebar-item" aria-label="依赖与窗口"><!--[--><!--]--> 依赖与窗口 <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial2-surface/" class="sidebar-item" aria-label="展示平面 (Surface)"><!--[--><!--]--> 展示平面 (Surface) <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial3-pipeline/" class="sidebar-item" aria-label="管线 (Pipeline)"><!--[--><!--]--> 管线 (Pipeline) <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial4-buffer/" class="sidebar-item" aria-label="缓冲区与索引"><!--[--><!--]--> 缓冲区与索引 <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial5-textures/" class="sidebar-item" aria-label="纹理和绑定组"><!--[--><!--]--> 纹理和绑定组 <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial6-uniforms/" class="sidebar-item" aria-label="Uniform 缓冲区与 3D 虚拟摄像机"><!--[--><!--]--> Uniform 缓冲区与 3D 虚拟摄像机 <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial7-instancing/" class="sidebar-item" aria-label="实例化绘制"><!--[--><!--]--> 实例化绘制 <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial8-depth/" class="sidebar-item" aria-label="深度缓冲区"><!--[--><!--]--> 深度缓冲区 <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/beginner/tutorial9-models/" class="sidebar-item" aria-label="模型加载"><!--[--><!--]--> 模型加载 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">进阶 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/learn-wgpu-zh/intermediate/tutorial10-lighting/" class="sidebar-item" aria-label="光照"><!--[--><!--]--> 光照 <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/intermediate/tutorial11-normals/" class="sidebar-item" aria-label="法线映射"><!--[--><!--]--> 法线映射 <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/intermediate/tutorial12-camera/" class="sidebar-item" aria-label="更好的摄像机"><!--[--><!--]--> 更好的摄像机 <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/intermediate/tutorial13-terrain/" class="sidebar-item" aria-label="程序地形"><!--[--><!--]--> 程序地形 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">案例展示 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/learn-wgpu-zh/showcase/windowless/" class="sidebar-item" aria-label="Wgpu without a window"><!--[--><!--]--> Wgpu without a window <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/showcase/gifs/" class="sidebar-item" aria-label="Creating gifs"><!--[--><!--]--> Creating gifs <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/learn-wgpu-zh/showcase/pong/" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Pong"><!--[--><!--]--> Pong <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/learn-wgpu-zh/showcase/pong/#the-architecture" class="router-link-active router-link-exact-active sidebar-item" aria-label="The Architecture"><!--[--><!--]--> The Architecture <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/learn-wgpu-zh/showcase/pong/#input" class="router-link-active router-link-exact-active sidebar-item" aria-label="Input"><!--[--><!--]--> Input <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/learn-wgpu-zh/showcase/pong/#render" class="router-link-active router-link-exact-active sidebar-item" aria-label="Render"><!--[--><!--]--> Render <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/learn-wgpu-zh/showcase/pong/#sound" class="router-link-active router-link-exact-active sidebar-item" aria-label="Sound"><!--[--><!--]--> Sound <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/learn-wgpu-zh/showcase/pong/#wasm-support" class="router-link-active router-link-exact-active sidebar-item" aria-label="WASM Support"><!--[--><!--]--> WASM Support <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/learn-wgpu-zh/showcase/pong/#summary" class="router-link-active router-link-exact-active sidebar-item" aria-label="Summary"><!--[--><!--]--> Summary <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/learn-wgpu-zh/showcase/compute/" class="sidebar-item" aria-label="Compute Example: Tangents and Bitangents"><!--[--><!--]--> Compute Example: Tangents and Bitangents <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/showcase/alignment/" class="sidebar-item" aria-label="Memory Layout in WGSL"><!--[--><!--]--> Memory Layout in WGSL <!--[--><!--]--></a><!----></li><li><a href="/learn-wgpu-zh/showcase/imgui-demo/" class="sidebar-item" aria-label="Basic Imgui Demo"><!--[--><!--]--> Basic Imgui Demo <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/learn-wgpu-zh/GLOSSARY_OF_TERMS.html" class="sidebar-item sidebar-heading" aria-label="术语中英对照表"><!--[--><!--]--> 术语中英对照表 <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="pong" tabindex="-1"><a class="header-anchor" href="#pong" aria-hidden="true">#</a> Pong</h1><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAB4AAAAQ4CAIAAABnsVYUAAAAA3NCSVQICAjb4U/gAAAAGXRFWHRTb2Z0d2FyZQBnbm9tZS1zY3JlZW5zaG907wO/PgAAGrRJREFUeJzs3ctqQkEQQEE7+P+/PFkEgoKGED0ZH1Wri4j0QqQ5DOPhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAI9pdg8AwN+ttS6+PuPnHQAADofrO/Mp+zNA52P3AAAAAAAAvCYBGgAAAACAhAANAAAAAEDCJUcAT8YddgAA8LPTnfnabuz/VAD+hxPQAAAAAAAkBGgAAAAAABICNAAAAAAACRcbATwx99YBAMCXW3ZjezVAxwloAAAAAAASAjQAAAAAAAkBGgAAAACAhAANAAAAAEBCgAYAAAAAICFAAwAAAACQEKABAAAAAEgI0AAAAAAAJARoAAAAAAASAjQAAAAAAAkBGgAAAACAxHH3AAAAAAC3mpnv57XWxefT9/zmcwC4nRPQAAAAAAAkBGgAAAAAABICNAAAAAAACRcbATyB03vrbuE+OwAA3s1vdml7MkDHCWgAAAAAABICNAAAAAAACQEaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgHc3uAQAAAACA+1tr7R7hzIwU+Y4+dg8AAAAAAMBrEqABAAAAAEgI0AAAAAAAJARoAAAAAAASAjQAAAAAAAkBGgAAAACAhAANAAAAAEBCgAYAAAAAICFAAwAAAACQEKABAAAAAEgI0AAAAAAAJARoAAAAAAASAjQAAAAAAAkBGgAAAACAhAANAAAAAEBCgAYAAAAAICFAAwAAAACQEKABAAAAAEgI0AAAAAAAJARoAAAAAAASAjQAAAAAAAkBGgAAAACAhAANAAAAAEBCgAYAAAAAICFAAwAAAACQEKABAAAAAEgcdw/AHmut3SOcmZndIwAAAAAAd+YENAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASBx3DwAAd7DW2j3CQ5uZ3SMAAADwjpyABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABICNAAAAAAACQEaAAAAAICEAA0AAAAAQEKABgAAAAAgIUADAAAAAJAQoAEAAAAASAjQAAAAAAAkBGgAAAAAABKzewD2WGvtHuHMjK8iAAAAALwaJ6ABAAAAAEgI0AAAAAAAJARoAAAAAAASAjQAAAAAAAkBGgAAAACAhAANAAAAAEBCgAYAAAAAICFAAwAAAACQEKABAAAAAEgI0AAAAAAAJARoAAAAAAASAjQAAAAAAAkBGgAAAACAhAANAAAAAEBCgAYAAAAAICFAAwAAAACQEKABAAAAAEgI0AAAAAAAJARoAAAAAAASAjQAAAAAAAkBGgAAAACAhAANAAAAAEBCgAYAAAAAICFAAwAAAACQEKABAAAAAEgI0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMBne3BAAgAAACDo/+t2BCoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADARnUXMiKE+bnlAAAAAElFTkSuQmCC" alt=""></p><p>Practically the &quot;Hello World!&quot; of games. Pong has been remade thousands of times. I know Pong. You know Pong. We all know Pong. That being said, this time I wanted to put in a little more effort than most people do. This showcase has a basic menu system, sounds, and different game states.</p><p>The architecture is not the best as I prescribed to the &quot;get things done&quot; mentality. If I were to redo this project, I&#39;d change a lot of things. Regardless, let&#39;s get into the postmortem.</p><h2 id="the-architecture" tabindex="-1"><a class="header-anchor" href="#the-architecture" aria-hidden="true">#</a> The Architecture</h2><p>I was messing around with separating state from the render code. It ended up similar to an Entity Component System model.</p><p>I had a <code>State</code> class with all of the objects in the scene. This included the ball and the paddles, as well as the text for the scores and even the menu. <code>State</code> also included a <code>game_state</code> field of type <code>GameState</code>.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Debug, Copy, Clone, Eq, PartialEq)]</span>
<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">GameState</span> <span class="token punctuation">{</span>
    <span class="token class-name">MainMenu</span><span class="token punctuation">,</span>
    <span class="token class-name">Serving</span><span class="token punctuation">,</span>
    <span class="token class-name">Playing</span><span class="token punctuation">,</span>
    <span class="token class-name">GameOver</span><span class="token punctuation">,</span>
    <span class="token class-name">Quiting</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>State</code> class didn&#39;t have any methods on it as I was taking a more data-oriented approach. Instead, I created a <code>System</code> trait and created multiple structs that implemented it.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">System</span> <span class="token punctuation">{</span>
    <span class="token attribute attr-name">#[allow(unused_variables)]</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">start</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> state<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">state<span class="token punctuation">::</span></span><span class="token class-name">State</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">update_state</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> 
        input<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">input<span class="token punctuation">::</span></span><span class="token class-name">Input</span><span class="token punctuation">,</span> 
        state<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">state<span class="token punctuation">::</span></span><span class="token class-name">State</span><span class="token punctuation">,</span> 
        events<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token namespace">state<span class="token punctuation">::</span></span><span class="token class-name">Event</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The systems would be in charge of controlling updating the different objects&#39; states (position, visibility, etc), as well as updating the <code>game_state</code> field. I created all the systems on startup and used a <code>match</code> on <code>game_state</code> to determine which ones should be allowed to run (the <code>visiblity_system</code> always runs as it is always needed).</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code>visiblity_system<span class="token punctuation">.</span><span class="token function">update_state</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> state<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> events<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">match</span> state<span class="token punctuation">.</span>game_state <span class="token punctuation">{</span>
    <span class="token namespace">state<span class="token punctuation">::</span></span><span class="token class-name">GameState</span><span class="token punctuation">::</span><span class="token class-name">MainMenu</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        menu_system<span class="token punctuation">.</span><span class="token function">update_state</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> state<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> events<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> state<span class="token punctuation">.</span>game_state <span class="token operator">==</span> <span class="token namespace">state<span class="token punctuation">::</span></span><span class="token class-name">GameState</span><span class="token punctuation">::</span><span class="token class-name">Serving</span> <span class="token punctuation">{</span>
            serving_system<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token namespace">state<span class="token punctuation">::</span></span><span class="token class-name">GameState</span><span class="token punctuation">::</span><span class="token class-name">Serving</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        serving_system<span class="token punctuation">.</span><span class="token function">update_state</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> state<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> events<span class="token punctuation">)</span><span class="token punctuation">;</span>
        play_system<span class="token punctuation">.</span><span class="token function">update_state</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> state<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> events<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> state<span class="token punctuation">.</span>game_state <span class="token operator">==</span> <span class="token namespace">state<span class="token punctuation">::</span></span><span class="token class-name">GameState</span><span class="token punctuation">::</span><span class="token class-name">Playing</span> <span class="token punctuation">{</span>
            play_system<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token namespace">state<span class="token punctuation">::</span></span><span class="token class-name">GameState</span><span class="token punctuation">::</span><span class="token class-name">Playing</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        ball_system<span class="token punctuation">.</span><span class="token function">update_state</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> state<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> events<span class="token punctuation">)</span><span class="token punctuation">;</span>
        play_system<span class="token punctuation">.</span><span class="token function">update_state</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> state<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> events<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> state<span class="token punctuation">.</span>game_state <span class="token operator">==</span> <span class="token namespace">state<span class="token punctuation">::</span></span><span class="token class-name">GameState</span><span class="token punctuation">::</span><span class="token class-name">Serving</span> <span class="token punctuation">{</span>
            serving_system<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> state<span class="token punctuation">.</span>game_state <span class="token operator">==</span> <span class="token namespace">state<span class="token punctuation">::</span></span><span class="token class-name">GameState</span><span class="token punctuation">::</span><span class="token class-name">GameOver</span> <span class="token punctuation">{</span>
            game_over_system<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token namespace">state<span class="token punctuation">::</span></span><span class="token class-name">GameState</span><span class="token punctuation">::</span><span class="token class-name">GameOver</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        game_over_system<span class="token punctuation">.</span><span class="token function">update_state</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> state<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> events<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> state<span class="token punctuation">.</span>game_state <span class="token operator">==</span> <span class="token namespace">state<span class="token punctuation">::</span></span><span class="token class-name">GameState</span><span class="token punctuation">::</span><span class="token class-name">MainMenu</span> <span class="token punctuation">{</span>
            menu_system<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token namespace">state<span class="token punctuation">::</span></span><span class="token class-name">GameState</span><span class="token punctuation">::</span><span class="token class-name">Quiting</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>It&#39;s definitely not the cleanest code, but it works.</p><p>I ended up having 6 systems in total.</p><ol><li><p>I added the <code>VisibilitySystem</code> near the end of development. Up to that point, all the systems had to set the <code>visible</code> field of the objects. That was a pain and cluttered the logic. Instead, I decided to create the <code>VisiblitySystem</code> to handle that.</p></li><li><p>The <code>MenuSystem</code> handled controlling what text was focused, and what would happen when the user pressed the enter key. If the <code>Play</code> button was focused, pressing enter would change <code>game_state</code> to <code>GameState::Serving</code> which would start the game. The <code>Quit</code> button would shift to <code>GameState::Quiting</code>.</p></li><li><p>The <code>ServingSystem</code> sets the ball&#39;s position to <code>(0.0, 0.0)</code>, updates the score texts, and shifts into <code>GameState::Playing</code> after a timer.</p></li><li><p>The <code>PlaySystem</code> controls the players. It allows them to move and keeps them from leaving the play space. This system runs on both <code>GameState::Playing</code> as well as <code>GameState::Serving</code>. I did this to allow the players to reposition themselves before the serve. The <code>PlaySystem</code> also will shift into <code>GameState::GameOver</code> when one of the players&#39; scores is greater than 2.</p></li><li><p>The <code>BallSystem</code> system controls the ball&#39;s movement as well as its bouncing of walls/players. It also updates the score and shifts to <code>GameState::Serving</code> when the ball goes off the side of the screen.</p></li><li><p>The <code>GameOver</code> system updates the <code>win_text</code> and shifts to <code>GameState::MainMenu</code> after a delay.</p></li></ol><p>I found the system approach quite nice to work with. My implementation wasn&#39;t the best, but I would like to work with it again. I might even implement my own ECS.</p><h2 id="input" tabindex="-1"><a class="header-anchor" href="#input" aria-hidden="true">#</a> Input</h2><p>The <code>System</code> trait, originally had a <code>process_input</code> method. This became a problem when I was implementing allowing players to move between serves. The players would get stuck when the <code>game_state</code> switched from <code>Serving</code> to <code>Playing</code> as the inputs were getting stuck. I only called <code>process_input</code> on systems that were currently in use. Changing that would be finicky, so I decided to move all the input code into its own struct.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">winit<span class="token punctuation">::</span>event<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">VirtualKeyCode</span><span class="token punctuation">,</span> <span class="token class-name">ElementState</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Debug, Default)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Input</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> p1_up_pressed<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> p1_down_pressed<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> p2_up_pressed<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> p2_down_pressed<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> enter_pressed<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Input</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">update</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token class-name">VirtualKeyCode</span><span class="token punctuation">,</span> state<span class="token punctuation">:</span> <span class="token class-name">ElementState</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">bool</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> pressed <span class="token operator">=</span> state <span class="token operator">==</span> <span class="token class-name">ElementState</span><span class="token punctuation">::</span><span class="token class-name">Pressed</span><span class="token punctuation">;</span>
        <span class="token keyword">match</span> key <span class="token punctuation">{</span>
            <span class="token class-name">VirtualKeyCode</span><span class="token punctuation">::</span><span class="token class-name">Up</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>p2_up_pressed <span class="token operator">=</span> pressed<span class="token punctuation">;</span>
                <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">VirtualKeyCode</span><span class="token punctuation">::</span><span class="token class-name">Down</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>p2_down_pressed <span class="token operator">=</span> pressed<span class="token punctuation">;</span>
                <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">VirtualKeyCode</span><span class="token punctuation">::</span><span class="token class-name">W</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>p1_up_pressed <span class="token operator">=</span> pressed<span class="token punctuation">;</span>
                <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">VirtualKeyCode</span><span class="token punctuation">::</span><span class="token class-name">S</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>p1_down_pressed <span class="token operator">=</span> pressed<span class="token punctuation">;</span>
                <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">VirtualKeyCode</span><span class="token punctuation">::</span><span class="token class-name">Return</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>enter_pressed <span class="token operator">=</span> pressed<span class="token punctuation">;</span>
                <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
            _ <span class="token operator">=&gt;</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">ui_up_pressed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">bool</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>p1_up_pressed <span class="token operator">||</span> <span class="token keyword">self</span><span class="token punctuation">.</span>p2_up_pressed
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">ui_down_pressed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">bool</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>p1_down_pressed <span class="token operator">||</span> <span class="token keyword">self</span><span class="token punctuation">.</span>p2_down_pressed
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This works really well. I simply pass this struct into the <code>update_state</code> method.</p><h2 id="render" tabindex="-1"><a class="header-anchor" href="#render" aria-hidden="true">#</a> Render</h2><p>I used <a href="https://docs.rs/wgpu_glyph" target="_blank" rel="noopener noreferrer">wgpu_glyph<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for the text and white quads for the ball and paddles. There&#39;s not much to say here, it&#39;s Pong after all.</p><p>I did mess around with batching, however. It was totally overkill for this project, but it was a good learning experience. Here&#39;s the code if you&#39;re interested.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">QuadBufferBuilder</span> <span class="token punctuation">{</span>
    vertex_data<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Vertex</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    index_data<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    current_quad<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">QuadBufferBuilder</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">Self</span> <span class="token punctuation">{</span>
            vertex_data<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            index_data<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            current_quad<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">push_ball</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> ball<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">state<span class="token punctuation">::</span></span><span class="token class-name">Ball</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> ball<span class="token punctuation">.</span>visible <span class="token punctuation">{</span>
            <span class="token keyword">let</span> min_x <span class="token operator">=</span> ball<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">-</span> ball<span class="token punctuation">.</span>radius<span class="token punctuation">;</span>
            <span class="token keyword">let</span> min_y <span class="token operator">=</span> ball<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">-</span> ball<span class="token punctuation">.</span>radius<span class="token punctuation">;</span>
            <span class="token keyword">let</span> max_x <span class="token operator">=</span> ball<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">+</span> ball<span class="token punctuation">.</span>radius<span class="token punctuation">;</span>
            <span class="token keyword">let</span> max_y <span class="token operator">=</span> ball<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">+</span> ball<span class="token punctuation">.</span>radius<span class="token punctuation">;</span>
    
            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">push_quad</span><span class="token punctuation">(</span>min_x<span class="token punctuation">,</span> min_y<span class="token punctuation">,</span> max_x<span class="token punctuation">,</span> max_y<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">self</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">push_player</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> player<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">state<span class="token punctuation">::</span></span><span class="token class-name">Player</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> player<span class="token punctuation">.</span>visible <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">push_quad</span><span class="token punctuation">(</span>
                player<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">-</span> player<span class="token punctuation">.</span>size<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">,</span> 
                player<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">-</span> player<span class="token punctuation">.</span>size<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">,</span> 
                player<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">+</span> player<span class="token punctuation">.</span>size<span class="token punctuation">.</span>x <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
                player<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">+</span> player<span class="token punctuation">.</span>size<span class="token punctuation">.</span>y <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">,</span> 
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">self</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">push_quad</span><span class="token punctuation">(</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> min_x<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span> min_y<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span> max_x<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span> max_y<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>vertex_data<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span>
            <span class="token class-name">Vertex</span> <span class="token punctuation">{</span>
                position<span class="token punctuation">:</span> <span class="token punctuation">(</span>min_x<span class="token punctuation">,</span> min_y<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token class-name">Vertex</span> <span class="token punctuation">{</span>
                position<span class="token punctuation">:</span> <span class="token punctuation">(</span>max_x<span class="token punctuation">,</span> min_y<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token class-name">Vertex</span> <span class="token punctuation">{</span>
                position<span class="token punctuation">:</span> <span class="token punctuation">(</span>max_x<span class="token punctuation">,</span> max_y<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token class-name">Vertex</span> <span class="token punctuation">{</span>
                position<span class="token punctuation">:</span> <span class="token punctuation">(</span>min_x<span class="token punctuation">,</span> max_y<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>index_data<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>current_quad <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>current_quad <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>current_quad <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>current_quad <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>current_quad <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>current_quad <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>current_quad <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">build</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> device<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Device</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token punctuation">(</span><span class="token class-name">StagingBuffer</span><span class="token punctuation">,</span> <span class="token class-name">StagingBuffer</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span>
            <span class="token class-name">StagingBuffer</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>device<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>vertex_data<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">StagingBuffer</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>device<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>index_data<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>index_data<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="sound" tabindex="-1"><a class="header-anchor" href="#sound" aria-hidden="true">#</a> Sound</h2><p>I used <a href="https://docs.rs/rodio" target="_blank" rel="noopener noreferrer">rodio<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for sound. I created a <code>SoundPack</code> class to store the sounds. Deciding how to get the sounds to play took some thinking. I chose to pass in a <code>Vec&lt;state::Event&gt;</code> into the <code>update_state</code> method. The system would then push an event to the <code>Vec</code>. The <code>Event</code> enum is listed below.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Debug, Copy, Clone)]</span>
<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Event</span> <span class="token punctuation">{</span>
    <span class="token class-name">ButtonPressed</span><span class="token punctuation">,</span>
    <span class="token class-name">FocusChanged</span><span class="token punctuation">,</span>
    <span class="token class-name">BallBounce</span><span class="token punctuation">(</span><span class="token namespace">cgmath<span class="token punctuation">::</span></span><span class="token class-name">Vector2</span><span class="token operator">&lt;</span><span class="token keyword">f32</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Score</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>I was going to have <code>BallBounce</code> play a positioned sound using a <code>SpatialSink</code>, but I was getting clipping issues, and I wanted to be done with the project. Aside from that, the events system worked nicely.</p><h2 id="wasm-support" tabindex="-1"><a class="header-anchor" href="#wasm-support" aria-hidden="true">#</a> WASM Support</h2><p>This example works on the web, but there are a few steps that I needed to take to make things work. The first one was that I needed to switch to using a <code>lib.rs</code> instead of just <code>main.rs</code>. I opted to use <a href="https://rustwasm.github.io/wasm-pack/" target="_blank" rel="noopener noreferrer">wasm-pack<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> to create the web assembly. I could have kept the old format by using wasm-bindgen directly, but I ran into issues with using the wrong version of wasm-bindgen, so I elected to stick with wasm-pack.</p><p>In order for wasm-pack to work properly I first needed to add some dependencies:</p><div class="language-toml ext-toml line-numbers-mode"><pre class="language-toml"><code><span class="token key property">cfg-if</span> <span class="token punctuation">=</span> <span class="token string">&quot;1&quot;</span>
<span class="token key property">env_logger</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.9&quot;</span>
<span class="token key property">winit</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.26&quot;</span>
<span class="token key property">anyhow</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.0&quot;</span>
<span class="token key property">bytemuck</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.4&quot;</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span> <span class="token string">&quot;derive&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token key property">cgmath</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.18&quot;</span>
<span class="token key property">pollster</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.2&quot;</span>
<span class="token key property">wgpu</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.13&quot;</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;spirv&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token key property">wgpu_glyph</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.17&quot;</span>
<span class="token key property">rand</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.8&quot;</span>
<span class="token key property">rodio</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.15&quot;</span><span class="token punctuation">,</span> <span class="token key property">default-features</span> <span class="token punctuation">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;wav&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token key property">log</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.4&quot;</span>
<span class="token key property">instant</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.1&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">target.&#39;cfg(target_arch = &quot;wasm32&quot;)&#39;.dependencies</span><span class="token punctuation">]</span>
<span class="token key property">console_error_panic_hook</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.1.6&quot;</span>
<span class="token key property">console_log</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.2.0&quot;</span>
<span class="token key property">getrandom</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.2&quot;</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;js&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token key property">rodio</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.15&quot;</span><span class="token punctuation">,</span> <span class="token key property">default-features</span> <span class="token punctuation">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;wasm-bindgen&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wav&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token key property">wasm-bindgen-futures</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.4.20&quot;</span>
<span class="token key property">wasm-bindgen</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.2.76&quot;</span>
<span class="token key property">web-sys</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.3.53&quot;</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;Document&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;Window&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;Element&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token key property">wgpu</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.13&quot;</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;spirv&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;webgl&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token table class-name">build-dependencies</span><span class="token punctuation">]</span>
<span class="token key property">anyhow</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.0&quot;</span>
<span class="token key property">fs_extra</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.2&quot;</span>
<span class="token key property">glob</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.3&quot;</span>
<span class="token key property">rayon</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.4&quot;</span>
<span class="token key property">naga</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.9&quot;</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;glsl-in&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;spv-out&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;wgsl-out&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>I&#39;ll highlight a few of these:</p><ul><li>rand: If you want to use rand on the web, you need to include getrandom directly and enable its <code>js</code> feature.</li><li>rodio: I had to disable all of the features for the WASM build, and then enabled them separately. The <code>mp3</code> feature specifically wasn&#39;t working for me. There might have been a workaround, but since I&#39;m not using mp3 in this example I just elected to only use wav.</li><li>instant: This crate is basically just a wrapper around <code>std::time::Instant</code>. In a normal build, it&#39;s just a type alias. In web builds it uses the browser&#39;s time functions.</li><li>cfg-if: This is a convenient crate for making platform-specific code less horrible to write.</li><li>env_logger and console_log: env_logger doesn&#39;t work on web assembly so we need to use a different logger. console_log is the one used in the web assembly tutorials, so I went with that one.</li><li>wasm-bindgen: This crate is the glue that makes Rust code work on the web. If you are building using the wasm-bindgen command you need to make sure that the command version of wasm-bindgen matches the version in Cargo.toml <strong>exactly</strong> otherwise you&#39;ll have problems. If you use wasm-pack it will download the appropriate wasm-bindgen binary to use for your crate.</li><li>web-sys: This has functions and types that allow you to use different methods available in js such as &quot;getElementById()&quot;.</li></ul><p>Now that that&#39;s out of the way let&#39;s talk about some code. First, we need to create a function that will start our event loop.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[cfg(target_arch=<span class="token string">&quot;wasm32&quot;</span>)]</span>
<span class="token keyword">use</span> <span class="token namespace">wasm_bindgen<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[cfg_attr(target_arch=<span class="token string">&quot;wasm32&quot;</span>, wasm_bindgen(start))]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Snipped...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>wasm_bindgen(start)</code> tell&#39;s wasm-bindgen that this function should be started as soon as the web assembly module is loaded by javascript. Most of the code inside this function is the same as what you&#39;d find in other examples on this site, but there is some specific stuff we need to do on the web.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token namespace">cfg_if<span class="token punctuation">::</span></span><span class="token macro property">cfg_if!</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token attribute attr-name">#[cfg(target_arch = <span class="token string">&quot;wasm32&quot;</span>)]</span> <span class="token punctuation">{</span>
        <span class="token namespace">console_log<span class="token punctuation">::</span></span><span class="token function">init_with_level</span><span class="token punctuation">(</span><span class="token namespace">log<span class="token punctuation">::</span></span><span class="token class-name">Level</span><span class="token punctuation">::</span><span class="token class-name">Warn</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;Could&#39;t initialize logger&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token namespace">std<span class="token punctuation">::</span>panic<span class="token punctuation">::</span></span><span class="token function">set_hook</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token namespace">console_error_panic_hook<span class="token punctuation">::</span></span>hook<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token namespace">env_logger<span class="token punctuation">::</span></span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This code should run before you try to do anything significant. It sets up the logger based on what architecture you&#39;re building for. Most architectures will use <code>env_logger</code>. The <code>wasm32</code> architecture will use <code>console_log</code>. It&#39;s also important that we tell Rust to forward panics to javascript. If we didn&#39;t do this we would have no idea when our Rust code panics.</p><p>Next, we create a window. Much of it is like we&#39;ve done before, but since we are supporting fullscreen we need to do some extra steps.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> event_loop <span class="token operator">=</span> <span class="token class-name">EventLoop</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> monitor <span class="token operator">=</span> event_loop<span class="token punctuation">.</span><span class="token function">primary_monitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> video_mode <span class="token operator">=</span> monitor<span class="token punctuation">.</span><span class="token function">video_modes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> size <span class="token operator">=</span> video_mode<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map_or</span><span class="token punctuation">(</span><span class="token class-name">PhysicalSize</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>vm<span class="token closure-punctuation punctuation">|</span></span> vm<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> window <span class="token operator">=</span> <span class="token class-name">WindowBuilder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">with_visible</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">with_title</span><span class="token punctuation">(</span><span class="token string">&quot;Pong&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">with_fullscreen</span><span class="token punctuation">(</span>video_mode<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>vm<span class="token closure-punctuation punctuation">|</span></span> <span class="token class-name">Fullscreen</span><span class="token punctuation">::</span><span class="token class-name">Exclusive</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>event_loop<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// WASM builds don&#39;t have access to monitor information, so</span>
<span class="token comment">// we should specify a fallback resolution</span>
<span class="token keyword">if</span> window<span class="token punctuation">.</span><span class="token function">fullscreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is_none</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">set_inner_size</span><span class="token punctuation">(</span><span class="token class-name">PhysicalSize</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We then have to do some web-specific stuff if we are on that platform.</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[cfg(target_arch = <span class="token string">&quot;wasm32&quot;</span>)]</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token namespace">winit<span class="token punctuation">::</span>platform<span class="token punctuation">::</span>web<span class="token punctuation">::</span></span><span class="token class-name">WindowExtWebSys</span><span class="token punctuation">;</span>
    <span class="token namespace">web_sys<span class="token punctuation">::</span></span><span class="token function">window</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>win<span class="token closure-punctuation punctuation">|</span></span> win<span class="token punctuation">.</span><span class="token function">document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>doc<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> dst <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">get_element_by_id</span><span class="token punctuation">(</span><span class="token string">&quot;wasm-example&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> canvas <span class="token operator">=</span> <span class="token namespace">web_sys<span class="token punctuation">::</span></span><span class="token class-name">Element</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">canvas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dst<span class="token punctuation">.</span><span class="token function">append_child</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>canvas<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

            <span class="token comment">// Request fullscreen, if denied, continue as normal</span>
            <span class="token keyword">match</span> canvas<span class="token punctuation">.</span><span class="token function">request_fullscreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Ok</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token class-name">Err</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;Couldn&#39;t append canvas to document body.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Everything else works the same.</p><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary" aria-hidden="true">#</a> Summary</h2><p>A fun project to work on. It was overly architected, and kinda hard to make changes, but a good experience nonetheless.</p><p>Try the code down below! (Controls currently require a keyboard.)</p><div id="wasm-example"><!----><button>Try Pong!</button></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/learn-wgpu-zh/showcase/gifs/" class="" aria-label="Creating gifs"><!--[--><!--]--> Creating gifs <!--[--><!--]--></a></span><span class="next"><a href="/learn-wgpu-zh/showcase/compute/" class="" aria-label="Compute Example: Tangents and Bitangents"><!--[--><!--]--> Compute Example: Tangents and Bitangents <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/learn-wgpu-zh/assets/js/runtime~app.da394f90.js" defer></script><script src="/learn-wgpu-zh/assets/js/9141.74699445.js" defer></script><script src="/learn-wgpu-zh/assets/js/app.7a8054bf.js" defer></script>
  </body>
</html>
